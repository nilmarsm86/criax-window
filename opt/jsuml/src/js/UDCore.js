var JSFun={extend:function(f,e){function d(){}d.prototype=e.prototype;f.prototype=new d();f.prototype.constructor=f;f.baseConstructor=e;f.base=e.prototype},isNumber:function(b){return typeof b==="number"&&isFinite(b)},isString:function(b){return typeof b==="string"},isArray:function(b){return Object.prototype.toString.call(b)==="[object Array]"},isBoolean:function(b){return typeof b==="boolean"}};var Point=function(d,c){this.setPoint(d,c)};Point.prototype.setPoint=function(d,c){if(d instanceof Point){this.setX(d._x);this.setY(d._y)}else{this.setX(d);this.setY(c)}return this};Point.prototype.setX=function(b){if(JSFun.isNumber(b)){this._x=b}return this};Point.prototype.setY=function(b){if(JSFun.isNumber(b)){this._y=b}return this};Point.prototype.getX=function(){return this._x};Point.prototype.getY=function(){return this._y};Point.prototype.equals=function(b){if(b instanceof Point&&this._x==b.x&&this.y==b._y){return true}else{return false}};Point.prototype.pixelX=function(){return parseInt(this._x)+0.5};Point.prototype.pixelY=function(){return parseInt(this._y)+0.5};var Element=function(){};Element.prototype.select=function(d,c){return false};Element.prototype.deselect=function(){};Element.prototype.drag=function(d,c){};Element.prototype.drop=function(d,c){};Element.prototype.draw=function(b){};Element.prototype.drawShape=function(b){};Element.prototype.isOver=function(d,c){return false};Element.prototype.setDiagram=function(b){};Element.prototype.getParent=function(){return null};Element.prototype.getCentralPoint=function(){return new Point()};Element.prototype.getLinkCentered=function(d,c){return new Point()};Element.prototype.setElementXML=function(b){};Element.prototype.getElementXML=function(b){return""};var JSGraphic={toPixel:function(b){return parseInt(b)+0.5},dashedLine:function(z,y,r,A,t,o){var x=Math.sqrt((A-y)*(A-y)+(t-r)*(t-r))/o;x=x/2-1;var w=Math.abs(Math.atan2(t-r,A-y));var p=Math.cos(w)*o;var q=Math.sin(w)*o;var s=y;var u=r;if(t<r){q=-q}z.beginPath();for(var v=0;v<x;v++){z.moveTo(s,u);s+=p;u+=q;z.lineTo(s,u);s+=p;u+=q}z.moveTo(s,u);s+=p;u+=q;if((p>0&&s>A)||(p<0&&s<A)){s=A}if((q>0&&u>t)||(q<0&&u<t)){u=t}z.lineTo(s,u);z.stroke()},lineIntersection:function(D,h,F,v,H,y,I,z){var E=v-h;var t=D-F;var B=-t*h-E*D;var G=z-y;var w=H-I;var C=-w*y-G*H;var u,x;if(D==F){u=D;x=-(C+G*u)/w}else{if(h==v){x=h;u=-(C+w*x)/G}else{if(H==I){u=H;x=-(B+E*u)/t}else{if(y==z){x=y;u=-(B+t*x)/E}else{var A=-t/w;u=-(A*C+B)/(E+A*G);x=-(B+E*u)/t}}}}return new Point(u,x)},ellipse:function(p,k,l,n,q){var m=0.5522847498307933;var o=m*n;var h=m*q;p.beginPath();p.moveTo(k-n,l);p.bezierCurveTo(k-n,l-h,k-o,l-q,k,l-q);p.bezierCurveTo(k+o,l-q,k+n,l-h,k+n,l);p.bezierCurveTo(k+n,l+h,k+o,l+q,k,l+q);p.bezierCurveTo(k-o,l+q,k-n,l+h,k-n,l)},rhombus:function(k,f,h,j,g){k.beginPath();k.moveTo(f,h+g/2);k.lineTo(f+j/2,h);k.lineTo(f+j,h+g/2);k.lineTo(f+j/2,h+g);k.closePath()},ellipseIntersection:function(q,r,o,p,u,a){var s=(a-r)/(u-q);var b=0;var m=0;var t;if(o>0&&p>0){b=Math.sqrt(1/(1/(o*o)+(s*s)/(p*p)))}t=(1-(b*b)/(o*o))*(p*p);if(o>0&&t>=0){m=Math.sqrt(t)}if(u<q){b=-b}if(a<r){m=-m}return new Point(q+b,r+m)}};var ComponentStyle={text_color:"#000000",font_size:"12px",font_width:7,line_height:13,component_color:"#00000"};var Component=function(b){b=b||{};this._x=0;this._y=0;this._width=0;this._height=0;this._minWidth=0;this._minHeight=0;this._superWidth=0;this._parent=null;this._setId(b.id||"");this._setMargin(b.margin||0);this._setPosition(b.position||Component.Float);this._setCentered(b.centered||false);this._orientation=b.orientation||0;this._visible=b.visible||true};Component.Static=0;Component.Float=1;Component.TopRight=2;Component.Bottom=3;Component.BottomLeft=4;Component.BottomRight=5;Component.TopLeft=8;Component.Xmovement=10;Component.Top=11;Component.Left=12;Component.Right=13;Component.prototype._setId=function(b){if(JSFun.isString(b)){this._id=b}else{this._id=""}};Component.prototype.getId=function(){return this._id};Component.prototype.setCoordinates=function(d,c){this._x=d;this._y=c};Component.prototype.updatePosition=function(c,d){this._x+=c;this._y+=d};Component.prototype.setWidth=function(b){if(b>this._minWidth){this._width=b+2*this._margin}else{this._width=this._minWidth}};Component.prototype.setHeight=function(b){if(b>this._minHeight){this._height=b+2*this._margin}else{this._height=this._minHeight}};Component.prototype.setVisibility=function(b){this._visible=b};Component.prototype.setMinWidth=function(b){if(b>0){this._minWidth=b}if(b>this._width){this._width=b}};Component.prototype.setMinHeight=function(b){if(b>0){this._minHeight=b}if(b>this._height){this._height=b}};Component.prototype.setSuperWidth=function(b){if(b>=0){this._superWidth=b}};Component.prototype._setMargin=function(b){if(JSFun.isNumber(b)){this._margin=b}else{this._margin=0}};Component.prototype.setParent=function(b){if(b instanceof Element||b instanceof SuperComponent||b instanceof Diagram){this._parent=b}};Component.prototype._setPosition=function(b){if(b==Component.Float||b==Component.Static||b==Component.TopRight||b==Component.Bottom||b==Component.BottomLeft||b==Component.BottomRight||b==Component.TopLeft||b==Component.sideLeft||b==Component.Xmovement||b==Component.Top||b==Component.Left||b==Component.Right){this._position=b}else{this._position=Component.Float}};Component.prototype._setCentered=function(b){if(b==true){this._centered=true}else{this._centered=false}};Component.prototype._getX=function(){return this._x};Component.prototype._getY=function(){return this._y};Component.prototype.getPixelX=function(){return JSGraphic.toPixel(this._x)};Component.prototype.getPixelY=function(){return JSGraphic.toPixel(this._y)};Component.prototype._getMX=function(){return this._x+this._margin};Component.prototype._getMY=function(){return this._y+this._margin};Component.prototype.getWidth=function(){return this._width};Component.prototype.getHeight=function(){return this._height};Component.prototype._getMargin=function(){return this._margin};Component.prototype.getSuperWidth=function(){if(this._parent instanceof SuperComponent){return this._parent.getSuperWidth()}else{return this._superWidth}};Component.prototype.getParent=function(){return this._parent};Component.prototype.getPosition=function(){return this._position};Component.prototype.isCentered=function(){return this._centered};Component.prototype.getComponentXML=function(c){var d=c.createElement("item");if(this._id){d.setAttribute("id",this._id)}d.setAttribute("value",this.getValue());return d};Component.prototype.notifyDraw=function(){if(this._parent){this._parent.notifyDraw()}};Component.prototype.notifyChange=function(){if(this._parent){var b=(this._orientation)?this._parent._height:this._parent._width;if(this._parent instanceof SuperNode){this._parent.notifyChange(true)}else{this._parent.notifyChange()}if(this._parent&&this._parent._parent instanceof SuperNode){this._parent._parent.notifyChange(true)}this._parent.notifyDraw()}};Component.prototype.notifyDelete=function(){if(this._parent instanceof SuperComponent||this._parent instanceof Diagram||this._parent.getParent() instanceof SuperNode){this._parent.notifyDelete(this)}};Component.prototype.notifyToUp=function(){if(this._parent instanceof SuperComponent){this._parent.notifyToUp(this)}};Component.prototype.notifyToDown=function(){if(this._parent instanceof SuperComponent){this._parent.notifyToDown(this)}};Component.prototype.isOver=function(d,c){if(this._visible&&d>=this._x&&d<=this._x+this._width&&c>=this._y&&c<=this._y+this._height){return true}else{return false}};Component.prototype.draw=function(b){};Component.prototype.select=function(d,c){return false};Component.prototype.drawShape=function(b){};Component.prototype.deselect=function(){};Component.prototype.setValue=function(b){};Component.prototype.getValue=function(){return};var SuperComponent=function(b){b=b||{};SuperComponent.baseConstructor.call(this,b);this._childs=[];this._activeChild=null;this._visibleSubComponents=true};JSFun.extend(SuperComponent,Component);SuperComponent.prototype.changeVisibility=function(){this._visibleSubComponents=!this._visibleSubComponents};SuperComponent.prototype.setVisibility=function(d){this._visible=d;for(var c=0;c<this._childs.length;c++){this._childs[c]._visible=d}};SuperComponent.prototype.visibilitySubComponents=function(){return this._visibleSubComponents};SuperComponent.prototype.getComponentXML=function(f){var e=f.createElement("superitem");e.setAttribute("id",this._id);e.setAttribute("visibleSubComponents",this._visibleSubComponents);var d;for(d in this._childs){e.appendChild(this._childs[d].getComponentXML(f))}return e};SuperComponent.prototype.setComponentXML=function(f){var e;var d=f.childNodes;if(f.getAttribute("visibleSubComponents")=="true"){this._visibleSubComponents=true}else{this._visibleSubComponents=false}for(e=0;e<d.length;e++){this.addField(d[e].getAttribute("value"))}};SuperComponent.prototype.updatePosition=function(f,e){SuperComponent.base.updatePosition.call(this,f,e);var d;for(d in this._childs){this._childs[d].updatePosition(f,e)}};SuperComponent.prototype.addSubComponent=function(b){if(b instanceof Component){b.setParent(this);this._childs.push(b)}};SuperComponent.prototype.delSubComponent=function(c){var d;for(d in this._childs){if(this._childs[d]==c){this._childs.splice(d,1);break}}};SuperComponent.prototype.updateComponents=function(){if(this._visibleSubComponents){var j=0;var f=0;var k;for(k in this._childs){if(this._orientation){if(this._childs[k].getHeight()>f){f=this._childs[k].getHeight()}j+=this._childs[k].getWidth()}else{if(this._childs[k].getWidth()>j){j=this._childs[k].getWidth()}f+=this._childs[k].getHeight()}}if(this._orientation){this.setWidth(j);this.setHeight(f+this._getMargin())}else{this.setWidth(j+this._getMargin());this.setHeight(f)}var g=this._getMX();var h=this._getMY();for(k=0;k<this._childs.length;k++){if(this._orientation){this._childs[k].setCoordinates(g,h);g+=this._childs[k].getWidth()}else{this._childs[k].setCoordinates(g,h);h+=this._childs[k].getHeight()}}}else{this.setWidth(1);this.setHeight(1)}};SuperComponent.prototype.select=function(e,f){if(this._visibleSubComponents){var d;for(d in this._childs){if(this._childs[d].select(e,f)){this._activeChild=this._childs[d];return true}}}};SuperComponent.prototype.deselect=function(){if(this._activeChild){this._activeChild.deselect();this._activeChild=null}};SuperComponent.prototype.drawShape=function(c){if(!this._visible){return}c.save();c.strokeStyle="#aaaaaa";c.strokeRect(this.getPixelX(),this.getPixelY(),this.getWidth(),this.getHeight());c.restore();if(this._visibleSubComponents){var d;for(d in this._childs){this._childs[d].drawShape(c)}}};SuperComponent.prototype.notifyToUp=function(f){var d;var e=f;for(d=0;d<this._childs.length;d++){if(this._childs[d]==f){if(d>0){this._childs[d]=this._childs[d-1];this._childs[d-1]=f}return}}};SuperComponent.prototype.notifyToDown=function(f){var d;var e=f;for(d=0;d<this._childs.length-1;d++){if(this._childs[d]==f){this._childs[d]=this._childs[d+1];this._childs[d+1]=f;return}}};SuperComponent.prototype.notifyChange=function(){this.updateComponents();if(this._parent){if(this._parent instanceof SuperNode){this._parent.notifyChange(true)}else{this._parent.notifyChange()}if(this._parent&&this._parent._parent instanceof SuperNode){this._parent._parent.notifyChange(true)}}};SuperComponent.prototype.notifyDelete=function(b){this.delSubComponent(b);this.updateComponents()};SuperComponent.prototype.draw=function(c){if(!this._visible){return}if(this._visibleSubComponents){var d;for(d in this._childs){this._childs[d].draw(c)}}};var Text=function(b){b=b||{};Text.baseConstructor.call(this,b);this.setText(b.text||"")};JSFun.extend(Text,Component);Text.prototype.setValue=function(b){this.setText(b)};Text.prototype.getValue=function(){return this._text};Text.prototype.setText=function(b){if(JSFun.isString(b)){this._text=b;if(b==""){if(this._orientation){this.setHeight(50)}else{this.setWidth(50)}}else{if(this._orientation){this.setHeight(this._text.length*ComponentStyle.font_width)}else{this.setWidth(this._text.length*ComponentStyle.font_width)}}if(this._orientation){this.setWidth(ComponentStyle.line_height)}else{this.setHeight(ComponentStyle.line_height)}}};Text.prototype.draw=function(b){if(!this._visible){return}b.save();b.font=ComponentStyle.font_size+" monospace";b.textBaseline="middle";b.fillStyle=ComponentStyle.text_color;if(this._orientation){b.translate(this._getMX()+ComponentStyle.line_height/2,this._getMY());b.rotate((-90*Math.PI)/180);b.fillText(this._text,this._margin*2-this.getHeight(),0)}else{b.fillText(this._text,this._getMX(),this._getMY()+ComponentStyle.line_height/2)}b.restore()};var TextBox=function(b){b=b||{};TextBox.baseConstructor.call(this,b);this.selected=b.selected||false;this.deletable=false;if(b.width){this._width=b.width}};JSFun.extend(TextBox,Text);TextBox.prototype.setDeletable=function(){this.deletable=true};TextBox.prototype.select=function(d,c){if(!this.selected&&this.isOver(d,c)){this.showDialog(d,c);return true}else{return false}};TextBox.prototype.deselect=function(){if(this.active){this.closeDialog();this.active=false}};TextBox.prototype.showDialog=function(){if(this.active){return}var l=this;this.active=true;var j=document.createElement("div");var m=document.createElement("form");var h=document.createElement("input");var g=document.createElement("input");j.className="ud_popup";h.setAttribute("type","text");h.setAttribute("value",this.decode(this.getValue()));g.setAttribute("type","submit");g.setAttribute("value","ok");this.changeText=function(a){if(l.active){l.setText(l.encode(h.value));document.body.removeChild(j);l.active=false;l.notifyChange()}};this.closeDialog=function(a){if(l.active){document.body.removeChild(j);l.active=false;l.notifyChange()}};m.onsubmit=function(){return false};g.addEventListener("click",this.changeText,false);m.appendChild(h);m.appendChild(g);if(this.deletable){var k=document.createElement("input");k.setAttribute("type","submit");k.setAttribute("value","delete");this.deleteDialog=function(a){if(l.active){document.body.removeChild(j);l.active=false;l.notifyDelete();l.notifyChange()}};k.addEventListener("click",this.deleteDialog,false);m.appendChild(k)}j.appendChild(m);document.body.appendChild(j);h.focus();j.style.top=(window.innerHeight-m.offsetHeight)/2+"px";j.style.left=(window.innerWidth-m.offsetWidth)/2+"px"};TextBox.prototype.drawShape=function(b){if(!this._visible){return}b.save();b.strokeStyle="#aaaaaa";b.strokeRect(this.getPixelX(),this.getPixelY(),this.getWidth(),this.getHeight());b.restore()};TextBox.prototype.draw=function(b){if(!this._visible){return}b.save();if(this.active){b.fillStyle="#ffc485";b.fillRect(this.getPixelX(),this.getPixelY(),this.getWidth(),this.getHeight())}b.restore();TextBox.base.draw.call(this,b)};TextBox.prototype.encode=function(b){return b};TextBox.prototype.decode=function(b){return b};var CollapsibleFields=function(b){b=b||{};CollapsibleFields.baseConstructor.call(this,b);this.setMinHeight(10);if(b.visibleSubComponents==false){this.changeVisibility()}};JSFun.extend(CollapsibleFields,SuperComponent);CollapsibleFields.prototype.addField=function(c){var d=this.newItem();d.setDeletable();if(c){d.setValue(c)}this.addSubComponent(d);this.notifyChange()};CollapsibleFields.prototype.newItem=function(){return new TextBox()};CollapsibleFields.prototype.select=function(d,c){if(Math.abs(d-(this._getX()+5))<=6&&Math.abs(c-(this._getY()+5))<=6){this.changeVisibility();this.notifyChange();return true}else{if(this.visibilitySubComponents()&&Math.abs(d-(this._getX()+this.getSuperWidth()-5))<=6&&Math.abs(c-(this._getY()+5))<=6){this.addField();return true}}return CollapsibleFields.base.select.call(this,d,c)};CollapsibleFields.prototype.drawShape=function(d){if(!this._visible){return}CollapsibleFields.base.drawShape.call(this,d);var e=this.getPixelX();var f=this.getPixelY();d.save();d.fillStyle="#ff0000";d.beginPath();if(this.visibilitySubComponents()){d.moveTo(e,f+5);d.lineTo(e+10,f+5);d.lineTo(e+5,f);d.closePath();d.fill();d.fillStyle="#94dc91";d.beginPath();d.arc(this.getPixelX()+this.getSuperWidth()-5,this.getPixelY()+5,4,0,Math.PI*2,true);d.closePath();d.fill();d.restore()}else{d.moveTo(e+5,f);d.lineTo(e+5,f+10);d.lineTo(e+10,f+5);d.closePath();d.fill();d.restore()}};CollapsibleFields.prototype.draw=function(b){if(!this._visible){return}if(this.visibilitySubComponents()){b.save();b.beginPath();b.moveTo(this.getPixelX(),this.getPixelY());b.lineTo(this.getPixelX()+this.getSuperWidth(),this.getPixelY());b.stroke();b.restore()}CollapsibleFields.base.draw.call(this,b)};var AttributeItem=function(c){c=c||{};AttributeItem.baseConstructor.call(this,c);var d="^(?:\xAB([^\xAB\xBB:={}]+)\xBB)?([#|+|-|~])?([/])?([^\xAB\xBB:={}]+)?(?::([^\xAB\xBB:={}]+))?(?:=([^\xAB\xBB:={}]+)?)?(?:{([^\xAB\xBB:={}]+)})?$";this._parse=new RegExp(d);this.setMinWidth(40)};JSFun.extend(AttributeItem,TextBox);AttributeItem.prototype.encode=function(d){var c="";if(d[0]){c+="\xAB"+d[0]+"\xBB"}if(d[1]){c+=d[1]}if(d[2]){c+=d[2]}if(d[3]){c+=d[3]}if(d[4]){c+=":"+d[4]}if(d[5]){c+="="+d[5]}if(d[6]){c+="{"+d[6]+"}"}if(this._parse.exec(c)){return c}else{return"wrong_attribute"}};AttributeItem.prototype.decode=function(c){var d=this._parse.exec(c);if(d){d.shift();return d}else{return[]}};AttributeItem.prototype.showDialog=function(){if(this.active){return}var u=this;this.active=true;var A=document.createElement("div");var z=document.createElement("form");var v=[];var x;for(x=0;x<7;x++){v.push(document.createElement("input"))}var y;v[1]=document.createElement("select");y=document.createElement("option");y.setAttribute("value","");y.appendChild(document.createTextNode("(none)"));v[1].appendChild(y);y=document.createElement("option");y.setAttribute("value","+");y.appendChild(document.createTextNode("+ (public)"));v[1].appendChild(y);y=document.createElement("option");y.setAttribute("value","-");y.appendChild(document.createTextNode("- (private)"));v[1].appendChild(y);y=document.createElement("option");y.setAttribute("value","#");y.appendChild(document.createTextNode("# (protected)"));v[1].appendChild(y);y=document.createElement("option");y.setAttribute("value","~");y.appendChild(document.createTextNode("~ (package)"));v[1].appendChild(y);v[2]=document.createElement("select");y=document.createElement("option");y.setAttribute("value","");y.appendChild(document.createTextNode("no"));v[2].appendChild(y);y=document.createElement("option");y.setAttribute("value","/");y.appendChild(document.createTextNode("yes"));v[2].appendChild(y);var s=document.createElement("input");A.className="ud_popup";var q=this.decode(this.getValue());for(x=0;x<v.length;x++){v[x].setAttribute("type","text");v[x].setAttribute("value",q[x]||"")}if(q[1]){var t=v[1].childNodes;for(x in t){if(t[x].value==q[1]){t[x].setAttribute("selected","selected")}}}if(q[2]){var t=v[2].childNodes;for(x in t){if(t[x].value==q[2]){t[x].setAttribute("selected","selected")}}}s.setAttribute("type","submit");s.setAttribute("value","ok");this.changeText=function(a){if(u.active){var c=[];var b;for(b=0;b<v.length;b++){c.push(v[b].value)}u.setText(u.encode(c));document.body.removeChild(A);u.active=false;u.notifyChange()}};this.closeDialog=function(a){if(u.active){document.body.removeChild(A);u.active=false;u.notifyChange()}};z.onsubmit=function(){return false};s.addEventListener("click",this.changeText,false);var w=["stereotype","visibility","derived","name","type","default","restrictions"];var r;var o;for(x=0;x<v.length;x++){o=document.createElement("div");r=document.createElement("label");r.appendChild(document.createTextNode(w[x]));o.appendChild(r);o.appendChild(v[x]);z.appendChild(o)}z.appendChild(s);if(this.deletable){var p=document.createElement("input");p.setAttribute("type","submit");p.setAttribute("value","delete");this.deleteDialog=function(a){if(u.active){document.body.removeChild(A);u.active=false;u.notifyDelete();u.notifyChange()}};p.addEventListener("click",this.deleteDialog,false);z.appendChild(p)}A.appendChild(z);document.body.appendChild(A);A.style.top=(window.innerHeight-z.offsetHeight)/2+"px";A.style.left=(window.innerWidth-z.offsetWidth)/2+"px"};AttributeItem.prototype.select=function(d,c){if(Math.abs(d-(this.getPixelX()+this.getSuperWidth()-20))<=5&&Math.abs(c-(this.getPixelY()+8.66))<=5){this.notifyToUp();this.notifyChange();return true}else{if(Math.abs(d-(this.getPixelX()+this.getSuperWidth()-30))<=5&&Math.abs(c-(this.getPixelY()+7.33))<=5){this.notifyToDown();this.notifyChange();return true}}return AttributeItem.base.select.call(this,d,c)};AttributeItem.prototype.drawShape=function(d){if(!this._visible){return}var e=this.getPixelX()+this.getSuperWidth()-35;var f=this.getPixelY()+3;d.save();d.fillStyle="#0000aa";d.beginPath();d.moveTo(e,f);d.lineTo(e+10,f);d.lineTo(e+5,f+7);d.closePath();d.fill();e=e+10;d.beginPath();d.moveTo(e+5,f);d.lineTo(e,f+7);d.lineTo(e+10,f+7);d.closePath();d.fill();d.restore()};var AttributeFields=function(b){b=b||{};AttributeFields.baseConstructor.call(this,b);this._default=b.text||"new_attribute"};JSFun.extend(AttributeFields,CollapsibleFields);AttributeFields.prototype.newItem=function(){return new AttributeItem({text:this._default})};var CircleSymbol=function(b){b=b||{};CircleSymbol.baseConstructor.call(this,b);this.setWidth(15);this.setHeight(15)};JSFun.extend(CircleSymbol,Component);CircleSymbol.prototype.draw=function(b){if(!this._visible){return}b.save();b.strokeStyle=ComponentStyle.component_color;b.beginPath();b.arc(this.getPixelX()+this._getMargin()+7,this.getPixelY()+this._getMargin()+7,7,0,Math.PI*2,true);b.stroke();b.restore()};var ComponentSymbol=function(b){b=b||{};ComponentSymbol.baseConstructor.call(this,b);this.setWidth(15);this.setHeight(15)};JSFun.extend(ComponentSymbol,Component);ComponentSymbol.prototype.draw=function(d){if(!this._visible){return}var e=this.getPixelX()+this._getMargin();var f=this.getPixelY()+this._getMargin();d.save();d.strokeStyle=ComponentStyle.component_color;d.strokeRect(e+1,f+2,8,4);d.strokeRect(e+1,f+9,8,4);d.beginPath();d.moveTo(e+5,f+2);d.lineTo(e+5,f);d.lineTo(e+15,f);d.lineTo(e+15,f+15);d.lineTo(e+5,f+15);d.lineTo(e+5,f+13);d.stroke();d.beginPath();d.moveTo(e+5,f+6);d.lineTo(e+5,f+9);d.stroke();d.restore()};var ConnectorItem=function(b){b=b||{};ConnectorItem.baseConstructor.call(this,b)};JSFun.extend(ConnectorItem,TextBox);ConnectorItem.prototype.setText=function(b){if(JSFun.isString(b)){this._text=b;if(b==""){if(this._orientation){this.setHeight(14)}else{this.setWidth(14)}}else{if(this._orientation){this.setHeight(this._text.length*ComponentStyle.font_width)}else{this.setWidth(this._text.length*ComponentStyle.font_width)}}if(this._orientation){this.setWidth(ComponentStyle.line_height)}else{this.setHeight(ComponentStyle.line_height)}}};var DataStoreItem=function(b){b=b||{};DataStoreItem.baseConstructor.call(this,b);this._parse=/^([a-zA-Z]*)(?:\[([^\[\]]*)\])?$/};JSFun.extend(DataStoreItem,TextBox);DataStoreItem.prototype.encode=function(d){var c="";if(d[0]){c+=d[0]}if(d[1]){c+="["+d[1]+"]"}if(this._parse.exec(c)){return c}else{return"wrong_operation"}};DataStoreItem.prototype.decode=function(c){var d=this._parse.exec(c);if(d){d.shift();return d}else{return[]}};DataStoreItem.prototype.showDialog=function(){if(this.active){return}var r=this;this.active=true;var w=document.createElement("div");w.className="ud_popup";var v=document.createElement("form");var s=[];var u;for(u=0;u<2;u++){s.push(document.createElement("input"))}var q=document.createElement("input");q.setAttribute("type","submit");q.setAttribute("value","ok");var o=this.decode(this.getValue());for(u=0;u<s.length;u++){s[u].setAttribute("type","text");s[u].setAttribute("value",o[u]||"")}this.changeText=function(b){if(r.active){var a=[];var c;for(c=0;c<s.length;c++){a.push(s[c].value)}r.setText(r.encode(a));document.body.removeChild(w);r.active=false;r.notifyChange()}};v.onsubmit=function(){return false};q.addEventListener("click",this.changeText,false);var t=["name","state"];var p;var m;for(u=0;u<s.length;u++){m=document.createElement("div");p=document.createElement("label");p.appendChild(document.createTextNode(t[u]));m.appendChild(p);m.appendChild(s[u]);v.appendChild(m)}v.appendChild(q);if(this.deletable){var n=document.createElement("input");n.setAttribute("type","submit");n.setAttribute("value","delete");this.deleteDialog=function(a){if(r.active){document.body.removeChild(w);r.active=false;r.notifyDelete();r.notifyChange()}};n.addEventListener("click",this.deleteDialog,false);v.appendChild(n)}w.appendChild(v);document.body.appendChild(w);q.focus();w.style.top=(window.innerHeight-v.offsetHeight)/2+"px";w.style.left=(window.innerWidth-v.offsetWidth)/2+"px"};var figureStyle={border:"#294253"};var NodeFigure=function(b){b=b||{};this._changeFigureColor=(b.changeFigureColor==false)?false:true;if(b.color){this._color=b.color}else{this._color="#ffffff"}};NodeFigure.prototype.draw=function(k,f,h,j,g){};NodeFigure.prototype.getColor=function(){return this._color};NodeFigure.prototype.setColor=function(b){if(this._changeFigureColor&&b){this._color=b}};var StickmanFigure=function(){};JSFun.extend(StickmanFigure,NodeFigure);StickmanFigure.prototype.draw=function(k,f,h,j,g){f=JSGraphic.toPixel(f);h=JSGraphic.toPixel(h);k.save();k.strokeStyle="#000000";k.beginPath();k.arc(f+j/2,h+j/4,j/4,0,Math.PI*2,true);k.moveTo(f+j/2,h+j/2);k.lineTo(f+j/2,h+j/2+g/3);k.lineTo(f,h+g);k.moveTo(f+j/2,h+j/2+g/3);k.lineTo(f+j,h+g);k.moveTo(f,h+g/2);k.lineTo(f+j,h+g/2);k.stroke();k.restore()};var EllipseFigure=function(b){b=b||{};EllipseFigure.baseConstructor.call(this,b)};JSFun.extend(EllipseFigure,NodeFigure);EllipseFigure.prototype.draw=function(m,o,k,l,h){var j=l/2;var n=h/2;m.save();m.shadowOffsetX=2;m.shadowOffsetY=2;m.shadowBlur=2;m.shadowColor="rgba(0, 0, 0, 0.5)";m.strokeStyle="#000000";m.lineWidth=2;JSGraphic.ellipse(m,o+j,k+n,j,n);m.stroke();m.restore();m.save();m.fillStyle=this.getColor();JSGraphic.ellipse(m,o+j,k+n,j,n);m.fill();m.restore()};var HalfFilledEllipseFigure=function(b){b=b||{};HalfFilledEllipseFigure.baseConstructor.call(this,b)};JSFun.extend(HalfFilledEllipseFigure,EllipseFigure);HalfFilledEllipseFigure.prototype.draw=function(m,o,k,l,h){var j=l/2;var n=h/2;m.save();m.shadowOffsetX=2;m.shadowOffsetY=2;m.shadowBlur=2;m.shadowColor="rgba(0, 0, 0, 0.5)";m.save();m.fillStyle=this.getColor();JSGraphic.ellipse(m,o+j,k+n,j,n);m.fill();m.restore();m.strokeStyle="#000000";m.lineWidth=2;JSGraphic.ellipse(m,o+j,k+n,j,n);m.stroke();m.restore();m.save();m.fillStyle="#000000";JSGraphic.ellipse(m,o+j,k+n,j*0.5,n*0.5);m.fill();m.restore()};var CrossEllipseFigure=function(b){b=b||{};CrossEllipseFigure.baseConstructor.call(this,b)};JSFun.extend(CrossEllipseFigure,EllipseFigure);CrossEllipseFigure.prototype.draw=function(n,q,l,m,j){var k=m/2;var o=j/2;var p=(Math.sqrt((m)*(m)+(j)*(j))-(k*2))/2;n.save();n.shadowOffsetX=2;n.shadowOffsetY=2;n.shadowBlur=2;n.shadowColor="rgba(0, 0, 0, 0.5)";n.fillStyle=this.getColor();JSGraphic.ellipse(n,q+k,l+o,k,o);n.fill();n.strokeStyle="#000000";n.lineWidth=2;JSGraphic.ellipse(n,q+k,l+o,k,o);n.moveTo(q+p,l+p);n.lineTo(q+m-p,l+j-p);n.moveTo(q+m-p,l+p);n.lineTo(q+p,l+j-p);n.stroke();n.restore()};var CrossFigure=function(b){b=b||{};CrossFigure.baseConstructor.call(this,b)};JSFun.extend(CrossFigure,NodeFigure);CrossFigure.prototype.draw=function(k,f,h,j,g){k.save();k.shadowOffsetX=2;k.shadowOffsetY=2;k.shadowBlur=2;k.shadowColor="rgba(0, 0, 0, 0.5)";k.strokeStyle=this.getColor();k.lineWidth=2;k.beginPath();k.moveTo(f,h);k.lineTo(f+j,h+g);k.moveTo(f+j,h);k.lineTo(f,h+g);k.closePath();k.stroke();k.restore()};var RhombusFigure=function(){};JSFun.extend(RhombusFigure,NodeFigure);RhombusFigure.prototype.draw=function(k,f,h,j,g){k.save();k.strokeStyle="#000000";k.fillStyle="#ffffff";JSGraphic.rhombus(k,f,h,j,g);k.fill();k.stroke();k.restore()};var RectangleFigure=function(b){b=b||{};RectangleFigure.baseConstructor.call(this,b)};JSFun.extend(RectangleFigure,NodeFigure);RectangleFigure.prototype.draw=function(o,h,k,n,j){var m=JSGraphic.toPixel(h);var l=JSGraphic.toPixel(k);o.save();o.shadowOffsetX=2;o.shadowOffsetY=2;o.shadowBlur=2;o.shadowColor="rgba(0, 0, 0, 0.5)";o.fillStyle=this.getColor();o.fillRect(h,k,n,j);o.restore();o.strokeStyle=figureStyle.border;o.strokeRect(m,l,n,j)};var ExpansionNodeFigure=function(b){b=b||{};ExpansionNodeFigure.baseConstructor.call(this,b)};JSFun.extend(ExpansionNodeFigure,NodeFigure);ExpansionNodeFigure.prototype.draw=function(o,h,k,n,j){var m=JSGraphic.toPixel(h);var l=JSGraphic.toPixel(k);o.save();o.shadowOffsetX=2;o.shadowOffsetY=2;o.shadowBlur=2;o.shadowColor="rgba(0, 0, 0, 0.5)";o.fillStyle=this.getColor();o.fillRect(h,k,n,j);o.beginPath();if(n<j){o.moveTo(m,JSGraphic.toPixel(k+j/4));o.lineTo(m+n,l+JSGraphic.toPixel(j/4));o.moveTo(m,JSGraphic.toPixel(l+2*(j/4)));o.lineTo(m+n,JSGraphic.toPixel(l+2*(j/4)));o.moveTo(m,JSGraphic.toPixel(l+3*(j/4)));o.lineTo(m+n,JSGraphic.toPixel(l+3*(j/4)))}else{o.moveTo(JSGraphic.toPixel(h+n/4),l);o.lineTo(m+JSGraphic.toPixel(n/4),l+j);o.moveTo(JSGraphic.toPixel(m+2*(n/4)),l);o.lineTo(JSGraphic.toPixel(m+2*(n/4)),l+j);o.moveTo(JSGraphic.toPixel(m+3*(n/4)),l);o.lineTo(JSGraphic.toPixel(m+3*(n/4)),l+j)}o.closePath();o.stroke();o.restore();o.strokeStyle=figureStyle.border;o.strokeRect(m,l,n,j)};var RoundedRectangleFigure=function(b){b=b||{};RoundedRectangleFigure.baseConstructor.call(this,b)};JSFun.extend(RoundedRectangleFigure,NodeFigure);RoundedRectangleFigure.prototype.draw=function(l,m,j,k,g){var m=JSGraphic.toPixel(m);var j=JSGraphic.toPixel(j);var h=4;l.save();l.shadowOffsetX=2;l.shadowOffsetY=2;l.shadowBlur=2;l.shadowColor="rgba(0, 0, 0, 0.5)";l.fillStyle=this.getColor();l.beginPath();l.moveTo(m+h,j);l.lineTo(m+k-h,j);l.quadraticCurveTo(m+k,j,m+k,j+h);l.lineTo(m+k,j+g-h);l.quadraticCurveTo(m+k,j+g,m+k-h,j+g);l.lineTo(m+h,j+g);l.quadraticCurveTo(m,j+g,m,j+g-h);l.lineTo(m,j+h);l.quadraticCurveTo(m,j,m+h,j);l.closePath();l.fill();l.restore();l.save();l.strokeStyle=figureStyle.border;l.beginPath();l.moveTo(m+h,j);l.lineTo(m+k-h,j);l.quadraticCurveTo(m+k,j,m+k,j+h);l.lineTo(m+k,j+g-h);l.quadraticCurveTo(m+k,j+g,m+k-h,j+g);l.lineTo(m+h,j+g);l.quadraticCurveTo(m,j+g,m,j+g-h);l.lineTo(m,j+h);l.quadraticCurveTo(m,j,m+h,j);l.stroke();l.restore()};var RegionFigure=function(b){b=b||{};RegionFigure.baseConstructor.call(this,b)};JSFun.extend(RegionFigure,NodeFigure);RegionFigure.prototype.draw=function(r,l,n,s,k,p,m,q){p=p||15;m=m||75;q=q||15;var o=4;var l=JSGraphic.toPixel(l);var n=JSGraphic.toPixel(n);r.save();r.shadowOffsetX=2;r.shadowOffsetY=2;r.shadowBlur=2;r.shadowColor="rgba(0, 0, 0, 0.5)";r.fillStyle=this.getColor();r.beginPath();r.fillRect(l+15,n,m,p);n+=p;k-=p;r.moveTo(l+o,n);r.lineTo(l+s-o,n);r.quadraticCurveTo(l+s,n,l+s,n+o);r.lineTo(l+s,n+k-o);r.quadraticCurveTo(l+s,n+k,l+s-o,n+k);r.lineTo(l+o,n+k);r.quadraticCurveTo(l,n+k,l,n+k-o);r.lineTo(l,n+o);r.quadraticCurveTo(l,n,l+o,n);r.closePath();r.fill();r.restore();n-=p;k+=p;r.save();r.strokeStyle=figureStyle.border;r.beginPath();r.strokeRect(l+15,n,m,p);n+=p;k-=p;r.moveTo(l+o,n);r.lineTo(l+s-o,n);r.quadraticCurveTo(l+s,n,l+s,n+o);r.lineTo(l+s,n+k-o);r.quadraticCurveTo(l+s,n+k,l+s-o,n+k);r.lineTo(l+o,n+k);r.quadraticCurveTo(l,n+k,l,n+k-o);r.lineTo(l,n+o);r.quadraticCurveTo(l,n,l+o,n);r.stroke();r.restore()};var PackageFigure=function(b){b=b||{};PackageFigure.baseConstructor.call(this,b)};JSFun.extend(PackageFigure,NodeFigure);PackageFigure.prototype.draw=function(k,f,h,j,g){k.save();k.shadowOffsetX=2;k.shadowOffsetY=2;k.shadowBlur=2;k.shadowColor="rgba(0, 0, 0, 0.5)";k.fillStyle=this.getColor();k.fillRect(f,h,60,15);k.fillRect(f,h+15,j,g-15);k.restore();k.strokeStyle=figureStyle.border;k.strokeRect(f+0.5,h+0.5,60,15);k.strokeRect(f+0.5,h+15.5,j,g-15)};var NoteFigure=function(b){b=b||{};NoteFigure.baseConstructor.call(this,b)};JSFun.extend(NoteFigure,NodeFigure);NoteFigure.prototype.draw=function(k,f,h,j,g){f=JSGraphic.toPixel(f);h=JSGraphic.toPixel(h);k.save();k.shadowOffsetX=2;k.shadowOffsetY=2;k.shadowBlur=2;k.shadowColor="rgba(0, 0, 0, 0.5)";k.fillStyle=this.getColor();k.beginPath();k.moveTo(f,h);k.lineTo(f+j-15,h);k.lineTo(f+j,h+15);k.lineTo(f+j,h+g);k.lineTo(f,h+g);k.closePath();k.fill();k.restore();k.save();k.strokeStyle=figureStyle.border;k.stroke();k.beginPath();k.moveTo(f+j-15,h);k.lineTo(f+j-15,h+15);k.lineTo(f+j,h+15);k.stroke();k.restore()};var FromImageFigure=function(b){b=b||{};FromImageFigure.baseConstructor.call(this,b);if(b.route){this.route=b.route;this.parent=b.parent;this.load=true;this.image=new Image();this.image.setAttribute("src",this.route)}this._associatedStereotypes=[]};JSFun.extend(FromImageFigure,NodeFigure);FromImageFigure.prototype.addAssociatedStereotype=function(b){this._associatedStereotypes.push(b)};FromImageFigure.prototype.delAssociatedStereotype=function(d){for(var c=0;c<this._associatedStereotypes.length;c++){if(this._associatedStereotypes[c]==d){this._associatedStereotypes.splice(c,1);break}}};FromImageFigure.prototype.foundInAssociatedStereotypes=function(d){for(var c=0;c<this._associatedStereotypes.length;c++){if(this._associatedStereotypes[c]==d){return true}}return false};FromImageFigure.prototype.draw=function(o,h,k,n,j){if(this.load){try{o.drawImage(this.image,h,k,n,j)}catch(l){}var m=this;this.image.onload=function(){if(m.parent._diagram._selected){o.drawImage(this,h,k,n,j)}}}};var LifelineFigure=function(b){b=b||{};LifelineFigure.baseConstructor.call(this,b)};JSFun.extend(LifelineFigure,NodeFigure);LifelineFigure.prototype.draw=function(n,o,k,m,h,j){j=j||25;var l=JSGraphic.toPixel(o+m/2);n.save();n.shadowOffsetX=2;n.shadowOffsetY=2;n.shadowBlur=2;n.shadowColor="rgba(0, 0, 0, 0.5)";n.fillStyle=this.getColor();n.fillRect(o,k,m,j);n.restore();n.save();n.strokeStyle=figureStyle.border;n.strokeRect(o+0.5,k+0.5,m,j);n.restore();JSGraphic.dashedLine(n,l,k+j,l,k+h,10)};var AcceptEventActionFigure=function(b){b=b||{};AcceptEventActionFigure.baseConstructor.call(this,b)};JSFun.extend(AcceptEventActionFigure,NodeFigure);AcceptEventActionFigure.prototype.draw=function(k,f,h,j,g){var f=JSGraphic.toPixel(f);var h=JSGraphic.toPixel(h);k.save();k.shadowOffsetX=2;k.shadowOffsetY=2;k.shadowBlur=2;k.shadowColor="rgba(0, 0, 0, 0.5)";k.fillStyle=this.getColor();k.beginPath();k.moveTo(f,h);k.lineTo(f+j,h);k.lineTo(f+j,h+g);k.lineTo(f,h+g);k.lineTo(f+25,h+g/2);k.closePath();k.fill();k.restore();k.save();k.strokeStyle=figureStyle.border;k.beginPath();k.moveTo(f,h);k.lineTo(f+j,h);k.lineTo(f+j,h+g);k.lineTo(f,h+g);k.lineTo(f+25,h+g/2);k.lineTo(f,h);k.stroke();k.restore()};var TimeEventFigure=function(b){b=b||{};TimeEventFigure.baseConstructor.call(this,b)};JSFun.extend(TimeEventFigure,NodeFigure);TimeEventFigure.prototype.draw=function(k,f,h,j,g){var f=JSGraphic.toPixel(f);var h=JSGraphic.toPixel(h);k.save();k.shadowOffsetX=2;k.shadowOffsetY=2;k.shadowBlur=2;k.shadowColor="rgba(0, 0, 0, 0.5)";k.strokeStyle=figureStyle.border;k.fillStyle=this.getColor();k.beginPath();k.moveTo(f,h);k.lineTo(f+j,h);k.lineTo(f+j/2,h+g/2);k.closePath();k.fill();k.beginPath();k.moveTo(f,h+g);k.lineTo(f+j,h+g);k.lineTo(f+j/2,h+g/2);k.closePath();k.fill();k.restore();k.save();k.strokeStyle=figureStyle.border;k.beginPath();k.moveTo(f,h);k.lineTo(f+j,h);k.lineTo(f+j/2,h+g/2);k.lineTo(f,h);k.stroke();k.beginPath();k.moveTo(f,h+g);k.lineTo(f+j,h+g);k.lineTo(f+j/2,h+g/2);k.lineTo(f,h+g);k.stroke();k.restore()};var SendSignalActionFigure=function(b){b=b||{};SendSignalActionFigure.baseConstructor.call(this,b)};JSFun.extend(SendSignalActionFigure,NodeFigure);SendSignalActionFigure.prototype.draw=function(k,f,h,j,g){var f=JSGraphic.toPixel(f);var h=JSGraphic.toPixel(h);k.save();k.shadowOffsetX=2;k.shadowOffsetY=2;k.shadowBlur=2;k.shadowColor="rgba(0, 0, 0, 0.5)";k.fillStyle=this.getColor();k.beginPath();k.moveTo(f,h);k.lineTo(f+j-25,h);k.lineTo(f+j,h+g/2);k.lineTo(f+j-25,h+g);k.lineTo(f,h+g);k.closePath();k.fill();k.restore();k.save();k.strokeStyle=figureStyle.border;k.beginPath();k.moveTo(f,h);k.lineTo(f+j-25,h);k.lineTo(f+j,h+g/2);k.lineTo(f+j-25,h+g);k.lineTo(f,h+g);k.lineTo(f,h);k.stroke();k.restore()};var SwimlaneFigure=function(b){b=b||{};SwimlaneFigure.baseConstructor.call(this,b)};JSFun.extend(SwimlaneFigure,NodeFigure);SwimlaneFigure.prototype.draw=function(k,f,h,j,g){var f=JSGraphic.toPixel(f);var h=JSGraphic.toPixel(h);k.save();k.lineWidth=2.5;k.shadowOffsetX=2;k.shadowOffsetY=2;k.shadowBlur=2;k.shadowColor="rgba(0, 0, 0, 0.5)";k.fillStyle=this.getColor();k.beginPath();k.moveTo(f+j,h);k.lineTo(f,h);k.lineTo(f,h+g);k.lineTo(f+j,h+g);k.stroke();k.restore()};var VerticalSwimlaneFigure=function(b){b=b||{};VerticalSwimlaneFigure.baseConstructor.call(this,b)};JSFun.extend(VerticalSwimlaneFigure,NodeFigure);VerticalSwimlaneFigure.prototype.draw=function(k,f,h,j,g){var f=JSGraphic.toPixel(f);var h=JSGraphic.toPixel(h);k.save();k.lineWidth=2.5;k.shadowOffsetX=2;k.shadowOffsetY=2;k.shadowBlur=2;k.shadowColor="rgba(0, 0, 0, 0.5)";k.fillStyle=this.getColor();k.beginPath();k.moveTo(f,h+g);k.lineTo(f,h);k.lineTo(f+j,h);k.lineTo(f+j,h+g);k.stroke();k.restore()};var NodeStyle={shape_color:"rgb( 0, 0, 0 )",control:""};var Node=function(b){b=b||{};this._id=0;this._type="untyped";this._x=b.x||0;this._y=b.y||0;this._prex=this._x;this._prey=this._y;this._relx=0;this._rely=0;this._width=10;this._height=10;this._minHeight=5;this._minWidth=5;this._selected=false;this._selectedBefore=false;this._resizing=false;this._moved=false;this._moveable=false;this._proportional=false;this._container=false;this._alone=false;this._figures=[];this._components=[];this._activeComponent=null;this._diagram=null;this._parent=null;this._nodeChilds=[];this._relationChilds=[];this._relations=[];this._menu=[];this._tagValues=[];this._selectedFigure=0;this._beforeNameComponent=null;this._visible=true;this._beforeHeight=0;this._beforeWidth=0};JSFun.extend(Node,Element);Node.prototype.setAlone=function(){this._alone=true};Node.prototype.isAlone=function(){return this._alone};Node.prototype.setId=function(b){this._id=this.getType()+"_"+b};Node.prototype.getId=function(){return this._id};Node.prototype.setType=function(b){if(this._type=="untyped"&&JSFun.isString(b)){this._type=b}};Node.prototype.getType=function(){return this._type};Node.prototype.getElementXML=function(e){var h=e.createElement(this.getType());var g=[];var f;h.setAttribute("id",this.getId());h.setAttribute("x",this.getX());h.setAttribute("y",this.getY());h.setAttribute("width",this._beforeWidth||this.getWidth());h.setAttribute("height",this._beforeHeight||this.getHeight());h.setAttribute("backgroundColor",this.getBackgroundColor());for(f=0;f<this._tagValues.length;f++){g.push(this._tagValues[f][0]+":"+this._tagValues[f][1])}h.setAttribute("tagValues",g);for(f in this._components){if(this._components[f].getId()){h.appendChild(this._components[f].getComponentXML(e))}}for(f in this._nodeChilds){h.appendChild(this._nodeChilds[f].getElementXML(e))}for(f in this._relationChilds){h.appendChild(this._relationChilds[f].getElementXML(e))}return h};Node.prototype.setElementXML=function(m){this.setPosition(parseInt(m.getAttribute("x")),parseInt(m.getAttribute("y")));this.resetMovement();this.setWidth(parseInt(m.getAttribute("width")));this.setHeight(parseInt(m.getAttribute("height")));this.setBackgroundColor(m.getAttribute("backgroundColor"));this.setBackgroundColor(m.getAttribute("backgroundColor"));var n=m.getAttribute("tagValues");var k=[];var l;while(n&&n!=""){l=n.indexOf(",");if(l==-1){k.push(n);n=""}else{k.push(n.substring(0,l));n=n.substring(l+1)}}this.setTagValues(k);var h;var o=m.childNodes;for(h=0;h<o.length;h++){if(o[h].nodeName=="item"){this.setValue(o[h].getAttribute("id"),o[h].getAttribute("value"))}else{if(o[h].nodeName=="superitem"){var j;for(j in this._components){if(this._components[j].getId()==o[h].getAttribute("id")){this._components[j].setComponentXML(o[h])}}}}}};Node.prototype.setValue=function(f,d){var e;for(e in this._components){if(!(this._components[e] instanceof SuperComponent)&&this._components[e].getId()==f){this._components[e].setValue(d);this.updateComponents();return true}}return false};Node.prototype.addValue=function(f,d){var e;for(e in this._components){if(this._components[e] instanceof SuperComponent&&this._components[e].getId()==f){this._components[e].addField(d);this.updateComponents();return true}}return false};Node.prototype.addChild=function(b){if(b instanceof Node){this._nodeChilds.push(b);b.setParent(this)}else{if(b instanceof Relation){this._relationChilds.push(b);b.setParent(this)}}};Node.prototype.delChild=function(c){var d;if(c instanceof Node){for(d in this._nodeChilds){if(this._nodeChilds[d]==c){this._nodeChilds.splice(d,1);c.setParent();break}}}else{if(c instanceof Relation){for(d in this._relationChilds){if(this._relationChilds[d]==c){this._relationChilds.splice(d,1);c.setParent();break}}}}};Node.prototype.addRelation=function(b){if(b instanceof Relation){this._relations.push(b)}};Node.prototype.delRelation=function(d){var c;for(c in this._relations){if(this._relations[c]==d){this._relations.splice(c,1);break}}};Node.prototype.setDiagram=function(b){if(b instanceof Diagram){this._diagram=b}};Node.prototype.notifyDraw=function(){if(this._diagram){this._diagram.draw()}};Node.prototype.notifyChange=function(){this._resizing=true;if(this._container){this.updateContainer();if(this._parent){var b=this._parent.getParent();while(b){if(b instanceof SuperNode){b.notifyChange(true);b=null}else{b=b._parent}}}}else{this.updateComponents();if(this._parent){this._parent.updateContainer();var b=this._parent.getParent();while(b){if(b instanceof SuperNode){b.notifyChange(true);b=null}else{b=b._parent}}}}this._resizing=false};Node.prototype.getX=function(){return this._x};Node.prototype.getY=function(){return this._y};Node.prototype.width=function(b){if(JSFun.isNumber(b)){this.setWidth(b);this.notifyChange();return true}return false};Node.prototype.height=function(b){if(JSFun.isNumber(b)){this.setHeight(b);this.notifyChange();return true}return false};Node.prototype.position=function(d,c){if(JSFun.isNumber(d)&&JSFun.isNumber(c)){this.setPosition(d,c);this.updatePosition();this.resetMovement();return true}return false};Node.prototype.setPosition=function(d,c){if(JSFun.isNumber(d)&&JSFun.isNumber(c)){this._x=d;this._y=c}};Node.prototype.getMovement=function(){return new Point(this._x-this._prex,this._y-this._prey)};Node.prototype.resetMovement=function(){this._prex=this._x;this._prey=this._y};Node.prototype.deselect=function(){this.deselectComponent();this._selectedBefore=false;this._selected=false};Node.prototype.deselectComponent=function(){if(this._activeComponent){this._activeComponent.deselect();this._activeComponent=null}};Node.prototype.select=function(d,f){if(!this._visible){return false}this.deselectComponent();if(this._diagram._activeMenu){this.removeContextualMenu()}if(this._diagram._pressMouse==true){if(this._selected){if(this._moveable&&Math.abs(d-(this._x+this._width+2.5))<=5&&Math.abs(f-(this._y+this._height+2.5))<=5){this._resizing=true;return true}}if(this._selected){if(this.isOverComponent(d,f)){this._relx=d-this._x;this._rely=f-this._y;this._selectedBefore=true;return true}}if(this.isOver(d,f)){this._relx=d-this._x;this._rely=f-this._y;this._selectedBefore=this._selected;this._selected=true;return true}else{return false}}else{if(this._diagram._pressMouseRight==true){if(this.isOver(d,f)){document.oncontextmenu=function(){return false};var e=document.documentElement.scrollTop||document.body.scrollTop;d=d+this._diagram._div.offsetLeft;f=(e)?(f-e+this._diagram._div.offsetTop):(f+this._diagram._div.offsetTop);this.showContextualMenu(d,f);return true}else{return false}}}};Node.prototype.showContextualMenu=function(f,g){if(this._diagram._activeMenu||!this._menu.length){return}this._diagram._activeMenu=true;var h=document.createElement("div");h.className="ud_contextualMenu";h.style.cursor="pointer";for(var e=0;e<this._menu.length;e++){this.addItem(this._menu[e],h)}document.body.appendChild(h);this._diagram._divMenu=h;h.style.top=g+"px";h.style.left=f+"px"};Node.prototype.removeContextualMenu=function(){if(this._diagram._activeMenu){document.body.removeChild(this._diagram._divMenu);this._diagram._activeMenu=false;this.notifyDraw()}};Node.prototype.addItem=function(h,f){var g=document.createElement("div");g.className="ud_contextualMenuItem";var e=document.createElement("span");e.appendChild(document.createTextNode(h[1]));g.appendChild(e);f.appendChild(g);g.addEventListener("mouseup",h[0],false)};Node.prototype.showColorDialog=function(F){var U=F.that||this;var Z=U._Backgroundcolor;var N=U._Backgroundcolor.split("#")[1];var J=new Array(parseInt(N.slice(0,2),16),parseInt(N.slice(2,4),16),parseInt(N.slice(4,6),16));var M=document.createElement("div");M.className="ud_popupColor";var O=document.createElement("div");O.setAttribute("id","divBlock1");var P=document.createElement("div");P.setAttribute("id","divBlock2");var ad=document.createElement("div");ad.setAttribute("id","colorHtml");ad.style.color="#ffffff";var ai=document.createElement("div");ai.setAttribute("id","red");var Q=document.createElement("canvas");Q.setAttribute("id","R");Q.width=150;Q.height=20;ai.appendChild(Q);var ah=Q.getContext("2d");var Y=document.createElement("div");Y.setAttribute("id","green");var K=document.createElement("canvas");K.setAttribute("id","G");K.width=150;K.height=20;Y.appendChild(K);var X=K.getContext("2d");var S=document.createElement("div");S.setAttribute("id","blue");var I=document.createElement("canvas");I.setAttribute("id","B");I.width=150;I.height=20;S.appendChild(I);var V=I.getContext("2d");var W=document.createElement("div");W.setAttribute("id","divSelectColor");var T=document.createElement("canvas");T.setAttribute("id","selectColor");T.width=90;T.height=90;W.appendChild(T);var af=T.getContext("2d");var ae=document.createElement("form");var L=document.createElement("input");L.setAttribute("type","submit");L.setAttribute("value","ok");var R=document.createElement("input");R.setAttribute("type","submit");R.setAttribute("value","cancel");var G=function(a){U.notifyDraw();document.body.removeChild(M)};var aa=function(a){U.setBackgroundColor(Z);document.body.removeChild(M)};L.addEventListener("click",G,false);R.addEventListener("click",aa,false);ae.onsubmit=function(){return false};L.focus();ae.appendChild(L);ae.appendChild(R);O.appendChild(ad);O.appendChild(ai);O.appendChild(Y);O.appendChild(S);O.appendChild(ae);M.appendChild(O);P.appendChild(W);P.appendChild(document.createElement("div"));M.appendChild(P);var H=function(b,c,a,d){if(a==0){a=0.1}else{if(a==120){a=119.9}}c.save();c.font="12px monospace";c.textBaseline="middle";c.fillStyle="#ffffff";c.fillText(b.getAttribute("id"),0,b.height/2);c.restore();c.save();c.beginPath();c.fillStyle=d;c.fillRect(20,0,parseInt(b.width)-50,Q.height);c.closePath();c.restore();c.fillStyle="#000000";c.beginPath();c.arc(20+(a*100)/255,parseInt(b.height)/2,4,0,Math.PI*2,true);c.closePath();c.fill();c.save();c.font="12px monospace";c.textBaseline="middle";c.fillStyle="#ffffff";c.fillText(parseInt(a),125,b.height/2);c.restore()};var ab=function(a){af.save();af.beginPath();af.fillStyle=a;af.fillRect(20,20,80,80);af.closePath();af.restore()};var ac=function(a){var b=function(d){var f="0123456789ABCDEF";var g=parseInt(d)%16;var e=(parseInt(d)-g)/16;hex=""+f.charAt(e)+f.charAt(g);return hex};var c=b(a[0])+b(a[1])+b(a[2]);while(ad.hasChildNodes()){ad.removeChild(ad.lastChild)}ad.appendChild(document.createTextNode("#"));ad.appendChild(document.createTextNode(c));U.setBackgroundColor("#"+c)};var ag=function(a){var b=a.pageX-M.offsetLeft-this.offsetLeft;var c=a.pageY-this.offsetTop;if(this.getAttribute("id")=="red"){J[0]=((b-20)*255)/100;if(J[0]>255){J[0]=255}if(J[0]<0){J[0]=0}ah.clearRect(0,0,parseInt(Q.width),Q.height);H(Q,ah,J[0],"#ff0000")}if(this.getAttribute("id")=="green"){J[1]=((b-20)*255)/100;if(J[1]>255){J[1]=255}if(J[1]<0){J[1]=0}X.clearRect(0,0,parseInt(K.width),K.height);H(K,X,J[1],"#00ff00")}if(this.getAttribute("id")=="blue"){J[2]=((b-20)*255)/100;if(J[2]>255){J[2]=255}if(J[2]<0){J[2]=0}V.clearRect(0,0,parseInt(I.width),I.height);H(I,V,J[2],"#0000ff")}ac(J);ab(U._Backgroundcolor)};H(Q,ah,J[0],"#ff0000");H(K,X,J[1],"#00ff00");H(I,V,J[2],"#0000ff");ab(U._Backgroundcolor);ac(J);ai.addEventListener("mousedown",ag,false);Y.addEventListener("mousedown",ag,false);S.addEventListener("mousedown",ag,false);document.body.appendChild(M);M.style.top=(window.innerHeight-parseInt(M.offsetHeight))/2+"px";M.style.left=(window.innerWidth-parseInt(M.offsetWidth))/2+"px"};Node.prototype.setTagValues=function(h){if(!JSFun.isArray(h)){return false}var f="";var k="";var j;for(var g=0;g<h.length;g++){j=h[g].indexOf(":");if(j==-1){f=h[g].substring(0)}else{f=h[g].substring(0,j);k=h[g].substring(j+1)}if(!this.foundInTagValues(this._tagValues,f)){this._tagValues.push([f,k])}}return true};Node.prototype.foundInTagValues=function(f,d){for(var e=0;e<f.length;e++){if(f[e][0]==d){return true}}return false};Node.prototype.setMenu=function(b){if(b instanceof Array){this._menu=b}};Node.prototype.getMenu=function(){return this._menu};Node.prototype.drag=function(h,k){if(this._resizing){var n=h-this._x;var o=k-this._y;n=Math.round(n);n=n-n%5;o=Math.round(o);o=o-o%5;var m=n;var j=o;if(this._proportional){var l=this._width/this._height;if(m>j){j=m/l}else{m=j*l}}this.setWidth(m);this.setHeight(j)}else{if(this._selected){var n=h-this._relx;var o=k-this._rely;n=Math.round(n);n=n-n%5;o=Math.round(o);o=o;this.setPosition(n,o);this._moved=true}}};Node.prototype.drop=function(f,h){if(this._moved){if(!this._alone){this._diagram.checkForParent(this)}this.updatePosition();if(this._parent){this._parent.updateContainer();var g=this._parent.getParent();while(g){if(g instanceof SuperNode){g.notifyChange(true);g=null}else{g=g._parent}}}}else{if(this._resizing){this.updatePosition();if(this instanceof SuperNode){var j=true;var k=true;this.notifyChange(j,k)}else{this.notifyChange()}if(this._parent){this._parent.updateContainer();var g=this._parent.getParent();while(g){if(g instanceof SuperNode){g.notifyChange(true,true);g=null}else{g=g._parent}}}}else{if(this._selectedBefore){this.selectComponent(f,h)}}}this._moved=false;this._resizing=false};Node.prototype.setContainer=function(){this._container=true};Node.prototype.isContainer=function(){if(this._container){return true}else{return false}};Node.prototype.isChildOf=function(b){if(this._parent==null){return false}else{if(this._parent==b){return true}else{return this._parent.isChildOf(b)}}};Node.prototype.setParent=function(b){if(b instanceof Node&&b._container){this._parent=b}else{this._parent=null}};Node.prototype.getParent=function(){return this._parent};Node.prototype.updateContainer=function(t){if(!(t==false||t==true)){t=true}if(this._container){var p;var s=this._x;var u=this._y;var v=this._x;var w=this._y;var r;var m,n,o,q;for(p in this._nodeChilds){r=this._nodeChilds[p];if(r._visible){o=r._x;q=r._y;m=r._x+r._width;n=r._y+r._height;if(m>v){v=m}if(n>w){w=n}if(o<s){s=o}if(q<u){u=q}}}if(s<this._x||u<this._y){this.setWidth(this._x-s+this._width);this.setHeight(this._y-u+this._height);this._x=s;this._y=u;this.setMinWidth(v-s);this.setMinHeight(w-u)}else{this.setMinWidth(v-this._x);this.setMinHeight(w-this._y)}this._prex=this._x;this._prey=this._y;this.updateComponents();if(this._parent&&t){this._parent.updateContainer()}}};Node.prototype.updatePosition=function(n,h,k){var o,j;k=k||false;if(n==undefined||h==undefined){var m=this.getMovement();var n=m.getX();var h=m.getY();for(o in this._relations){this._relations[o].updatePosition()}}else{this._x+=n;this._y+=h}this.resetMovement();for(o in this._components){this._components[o].updatePosition(n,h)}for(o in this._relations){var l=this._relations[o].getParent();if((l!=this._parent&&!(l instanceof SuperNode&&l==this._parent._parent))||(k)){this._relations[o].notifyChange()}}if(this._container){for(o in this._nodeChilds){this._nodeChilds[o].updatePosition(n,h)}for(o in this._relationChilds){this._relationChilds[o].updatePosition(n,h)}}};Node.prototype.getParticularWidth=function(b){if(b>=this._y&&b<=this._y+this._height){return[this._x,this._width]}return[0,0]};Node.prototype.getParticularHeight=function(b){if(b>=this._x&&b<=this._x+this._width){return[this._y,this._height]}return[0,0]};Node.prototype.isOverComponent=function(e,f){var d;for(d=0;d<this._components.length;d+=1){if(this._components[d].isOver(e,f)){return true}}return false};Node.prototype.selectComponent=function(e,f){var d;for(d=0;d<this._components.length;d+=1){if(this._components[d].select(e,f)){this._activeComponent=this._components[d];return}}};Node.prototype.addFigure=function(b){if(b instanceof NodeFigure){if(!(b instanceof FromImageFigure)){this.setBackgroundColor(b._color)}this._figures.push(b)}};Node.prototype.delFigure=function(c){if(c instanceof NodeFigure){for(var d=1;d<this._figures.length;d++){if(this._figures[d]==c){if(this._selectedFigure==d){this.setSelectedFigure(0)}this._figures.splice(d,1);break}}}};Node.prototype.setBackgroundColor=function(d){this._Backgroundcolor=d;for(var c=0;c<this._figures.length;c++){this._figures[c].setColor(d)}};Node.prototype.getBackgroundColor=function(){return this._Backgroundcolor};Node.prototype.setSelectedFigure=function(h){if(JSFun.isNumber(h)&&h>-1&&h<this._figures.length){if(this._selectedFigure==h){return false}this._selectedFigure=h;if(this._figures[h] instanceof FromImageFigure){for(var f=0;f<this._components.length;f++){if(this._components[f]._id=="name"){if(!this._beforeNameComponent){this._beforeNameComponent=this._components[f];var g=this._beforeNameComponent._text;var e=this._beforeNameComponent.selected;if(this._beforeNameComponent instanceof TextArea){this._components[f]=new TextArea({id:"name",text:g.join("\n"),selected:e,position:Component.Bottom,margin:3})}if(this._beforeNameComponent instanceof TextBox){this._components[f]=new TextBox({id:"name",text:g,selected:e,position:Component.Bottom,margin:3})}this._components[f].setParent(this)}}else{this._components[f].setVisibility(false)}}this._beforeHeight=this._height;this._beforeWidth=this._width;for(f=0;f<this._nodeChilds.length;f++){this._nodeChilds[f].setVisibility(false)}}else{for(var f=0;f<this._components.length;f++){if(this._components[f]._id=="name"){if(this._beforeNameComponent){if(this._beforeNameComponent instanceof TextArea){this._beforeNameComponent.setText(this._components[f]._text.join("\n"))}else{if(this._beforeNameComponent instanceof TextBox){this._beforeNameComponent.setText(this._components[f]._text)}}this._components[f]=this._beforeNameComponent;this._beforeNameComponent=null}}else{if(!(this._components[f] instanceof SpecificationItem)||this._components[f] instanceof SpecificationItem&&this._components[f].getValue()!=""){this._components[f].setVisibility(true)}}}for(f=0;f<this._nodeChilds.length;f++){this._nodeChilds[f].setVisibility(true)}this.setHeight(this._beforeHeight);this.setWidth(this._beforeWidth);this._beforeHeight=0;this._beforeWidth=0;this.notifyChange(true)}this.updateComponents()}return true};Node.prototype.setVisibility=function(e){this._visible=e;var f=true;if(this._selectedFigure&&e){f=false}for(var d=0;d<this._components.length;d++){if(f||(!f&&this._components[d]._id=="name")){this._components[d].setVisibility(e)}}if(this._container&&f){for(d=0;d<this._nodeChilds.length;d++){this._nodeChilds[d].setVisibility(e)}}};Node.prototype.drawFigures=function(c){var d;for(d=0;d<this._figures.length;d+=1){if(d==this._selectedFigure){this._figures[d].draw(c,this._x,this._y,this._width,this._height)}}};Node.prototype.addComponent=function(b){if(b instanceof Component){b.setParent(this);this._components.push(b);this.updateComponents()}};Node.prototype.calculateSize=function(){if(this._components.length>0){var h;var l=0;var m=0;var j;var k=false;var g;for(g in this._components){h=this._components[g];if(h._visible&&!(h instanceof RegionLine)&&(h.getPosition()==Component.Float||(h.getPosition()==Component.BottomLeft&&h._visible)||h.getPosition()==Component.BottomRight||h.getPosition()==Component.Xmovement)){if(h._orientation){l+=h.getWidth();if(!(h instanceof RegionLine)&&h.getHeight()>m){m=h.getHeight()}}else{m+=h.getHeight();j=(h.getPosition()==Component.Xmovement)?(h.getWidth()+2*h._parent._Xmovement):h.getWidth();if(!(h instanceof RegionLine)&&j>l){l=j}}}else{if(!h._visible){k=true}}}if(m==0&&k==true){m=20}if(l==0&&k==true){l=20}if(this._container&&!this._selectedFigure){if(m>this._minHeight){this.setMinHeight(m)}if(l>this._minWidth){this.setMinWidth(l)}}else{if(m>0){this.setMinHeight(m)}if(l>0){this.setMinWidth(l)}}}};Node.prototype.insertComponents=function(q,r,y,o){var w;var v;var x=-1;var t=-1;var s=-1;var n=-1;var u=[];for(w=0;w<this._components.length;w++){v=this._components[w];if(v instanceof Separator){if(v._orientation){var p=this.getParticularHeight(q);v.setCoordinates(q,p[0]);v.setHeight(p[1]-2*v._margin)}else{var p=this.getParticularWidth(r);v.setCoordinates(p[0],r);v.setWidth(p[1])}}else{if(v.isCentered()){if(v._orientation){v.setCoordinates(q,r+o/2-v.getHeight()/2)}else{v.setCoordinates(q+y/2-v.getWidth()/2,r)}}else{if(v.getPosition()==Component.TopRight){v.setCoordinates(q+y-v.getWidth(),this._y)}else{if(v.getPosition()==Component.TopLeft){v.setCoordinates(q,this._y)}else{if(v.getPosition()==Component.Top&&v._visible){u.push(v)}else{if(v.getPosition()==Component.Bottom&&v._visible){if(t==-1){t=this._y+this._height}v.setCoordinates(this._x+this._width/2-v.getWidth()/2,t);t+=v.getHeight()}else{if(v.getPosition()==Component.Left&&v._visible){if(s==-1){s=this._y+this._height/2-v.getHeight()/2}v.setCoordinates(this._x-v.getWidth(),s);s+=v.getHeight()}else{if(v.getPosition()==Component.Right&&v._visible){if(n==-1){n=this._y+this._height/2-v.getHeight()/2}v.setCoordinates(this._x+this._width,n);n+=v.getHeight()}else{if(v.getPosition()==Component.BottomLeft){v.setCoordinates(this._x,this._y+this._height-v.getHeight())}else{if(v.getPosition()==Component.BottomRight){v.setCoordinates(this._x+this._width-v.getWidth(),this._y+this._height-v.getHeight())}else{if(v.getPosition()==Component.Xmovement){v.setCoordinates(q+this._Xmovement,r)}else{v.setCoordinates(q,r);v.setSuperWidth(this._width)}}}}}}}}}}}if(v.getPosition()==Component.Float||v.getPosition()==Component.Xmovement){if(v._orientation){q+=v.getWidth()}else{r+=v.getHeight()}}if(v instanceof SuperComponent){v.updateComponents()}}for(w=u.length-1;w>-1;w--){if(x==-1){x=this._y-u[w].getHeight()}u[w].setCoordinates(this._x+this._width/2-u[w].getWidth()/2,x);if(w!=0){x-=u[w-1].getHeight()}if(u[w] instanceof SuperComponent){u[w].updateComponents()}}};Node.prototype.updateComponents=function(c){c=(c==undefined)?true:c;if(this._components.length>0){this.calculateSize();this.insertComponents(this._x,this._y,this._width,this._height)}if(c){var d;for(d in this._relations){this._relations[d].notifyChange()}}};Node.prototype.drawComponents=function(c){var d;for(d=0;d<this._components.length;d+=1){this._components[d].draw(c)}};Node.prototype.drawComponentsShape=function(c){var d;for(d=0;d<this._components.length;d+=1){this._components[d].drawShape(c)}};Node.prototype.setMoveable=function(){this._moveable=true};Node.prototype.setProportional=function(){this._proportional=true};Node.prototype.setWidth=function(b){if(b<this._minWidth){b=this._minWidth}this._width=b};Node.prototype.setHeight=function(b){if(b<this._minHeight){b=this._minHeight}this._height=b};Node.prototype.setMinWidth=function(b){if(b<0){this._minWidth=0}else{this._minWidth=b}if(this._width<this._minWidth){this._width=this._minWidth}};Node.prototype.setMinHeight=function(b){if(b<0){this._minHeight=0}else{this._minHeight=b}if(this._height<this._minHeight){this._height=this._minHeight}};Node.prototype.getWidth=function(){return this._width};Node.prototype.getHeight=function(){return this._height};Node.prototype.draw=function(b){if(!this._visible){return}b.save();b.fillStyle=NodeStyle.shape_color;if(this._moveable&&this._selected){b.fillRect(parseInt(this._x+this._width),parseInt(this._y+this._height),5,5)}b.restore();this.drawFigures(b);this.drawComponents(b);if(this._selected){this.drawComponentsShape(b)}};Node.prototype.isOver=function(d,c){if(d instanceof Point){c=d.getY();d=d.getX()}if(d>=this._x&&d<=this._x+this._width&&c>=this._y&&c<=this._y+this._height){return true}return false};Node.prototype.isOverBeforePosition=function(d,c){if(d instanceof Point){c=d.getY();d=d.getX()}if(d>=this._prex&&d<=this._prex+this._width&&c>=this._prey&&c<=this._prey+this._height&&d>=this._x&&d<=this._x+this._width){return true}return false};Node.prototype.getArea=function(){return this._width*this._height};Node.prototype.notifyDelete=function(c){if(this._parent instanceof SuperNode){var d;for(d in this._components){if(this._components[d]==c){this._components.splice(d,1);break}}this.updateComponents()}};Node.prototype.drawShape=function(b){b.save();b.lineWidth=2.5;b.strokeStyle=NodeStyle.shape_color;b.strokeRect(JSGraphic.toPixel(this._x),JSGraphic.toPixel(this._y),this._width,this._height);b.restore()};Node.prototype.getCentralPoint=function(){return new Point(this._x+this._width/2,this._y+this._height/2)};Node.prototype.getLinkCentered=function(n,o){if(n instanceof Point){o=n.getY();n=n.getX()}var l=0;var m=0;var s=this._width/2;var k=this._height/2;var p=this._x+s;var q=this._y+k;if(n-p!=0){var r=(o-q)/(n-p);l=Math.abs(k/r);m=Math.abs(s*r)}else{l=0;m=k}if(l>s){l=s}if(m>k){m=k}if(n<p){l=-l}if(o<q){m=-m}return new Point(p+l,q+m)};Node.prototype.getLink=function(n,o,p,q){if(!p||!q){return this.getLinkCentered(n,o)}var l=0;var m=0;var s=p-this._x;var k=q-this._y;if(n>p){s=this._width-s}if(o>q){k=this._height-k}if(n-p!=0){var r=(o-q)/(n-p);l=Math.abs(k/r);m=Math.abs(s*r)}else{l=0;m=k}if(l>s){l=s}if(m>k){m=k}if(n<p){l=-l}if(o<q){m=-m}return new Point(p+l,q+m)};Node.prototype.notifyDeleted=function(d){var c;for(c in this._relations){if(this._relations[c]==d){this._relations.splice(c,1)}}};Node.prototype.deleted=function(){var d;while(this._relations[0]){(this._relations.pop()).deleted()}if(this._parent){var c=this._parent;this._parent.delChild(this);c.updateContainer()}if(this._container){while(this._nodeChilds[0]){(this._nodeChilds.pop()).deleted()}}this._diagram.notifyDeleted(this)};Node.prototype.toString=function(){return"Node"};var RelationLine=function(){};RelationLine.prototype.draw=function(d,f,e){};var SolidLine=function(){};JSFun.extend(SolidLine,RelationLine);SolidLine.prototype.draw=function(h,g,f){var e;h.save();h.strokeStyle=f;h.lineWidth=1.25;h.beginPath();h.moveTo(g[0].pixelX(),g[0].pixelY());for(e=1;e<g.length;e++){h.lineTo(g[e].pixelX(),g[e].pixelY())}h.stroke();h.restore()};var DashedLine=function(){};JSFun.extend(DashedLine,RelationLine);DashedLine.prototype.draw=function(h,g,f){var e;h.save();h.strokeStyle=f;h.lineWidth=1.25;for(e=0;e<g.length-1;e++){JSGraphic.dashedLine(h,g[e].pixelX(),g[e].pixelY(),g[e+1].pixelX(),g[e+1].pixelY(),10)}h.restore()};var RelationEnd=function(){};RelationEnd.prototype.draw=function(k,g,h,j,f){};var CloseTip=function(b){b=b||{};this._color=b.color||"#ffffff"};JSFun.extend(CloseTip,RelationEnd);CloseTip.prototype.draw=function(k,g,h,j,f){k.save();k.strokeStyle=f;k.fillStyle=this._color;k.translate(g,h);k.rotate(j);k.beginPath();k.moveTo(0,0);k.lineTo(-8.5,5.5);k.lineTo(-8.5,-5.5);k.closePath();k.fill();k.stroke();k.restore()};var OpenTip=function(){};JSFun.extend(OpenTip,RelationEnd);OpenTip.prototype.draw=function(k,g,h,j,f){k.save();k.strokeStyle=f;k.fillStyle="#ffffff";k.translate(g,h);k.rotate(j);k.beginPath();k.moveTo(-8.5,5.5);k.lineTo(0,0);k.lineTo(-8.5,-5.5);k.stroke();k.restore()};var AggregationEnd=function(){};JSFun.extend(AggregationEnd,RelationEnd);AggregationEnd.prototype.draw=function(k,g,h,j,f){k.save();k.strokeStyle=f;k.fillStyle="#ffffff";k.translate(g,h);k.rotate(j);k.beginPath();k.moveTo(0,0);k.lineTo(-7,-5);k.lineTo(-14,0);k.lineTo(-7,5);k.closePath();k.fill();k.stroke();k.restore()};var CompositionEnd=function(){};JSFun.extend(CompositionEnd,RelationEnd);CompositionEnd.prototype.draw=function(k,g,h,j,f){k.save();k.fillStyle="#000000";k.translate(g,h);k.rotate(j);k.beginPath();k.moveTo(0,0);k.lineTo(-7,-5);k.lineTo(-14,0);k.lineTo(-7,5);k.closePath();k.fill();k.restore()};var InterfaceUsage=function(){};JSFun.extend(InterfaceUsage,RelationEnd);InterfaceUsage.prototype.draw=function(k,g,h,j,f){k.save();k.strokeStyle=f;k.translate(g,h);k.rotate(j);k.beginPath();k.arc(8,0,12,Math.PI/2,Math.PI*1.5,false);k.stroke();k.restore()};var RelationStyle={shape_color:"#000000",line_color:"#000000"};var Relation=function(b){b=b||{};this._id=0;this._type="untyped";this._points=[new Point(),new Point()];this._selected=-1;this._selectedBefore=false;this._moved=false;this._activeComponent=null;this._selectedLine=false;this._selectedPoint=false;this._components=[];this._relations=[];this._diagram=null;this.setElements(b.a,b.b)};JSFun.extend(Relation,Element);Relation.prototype.setElements=function(c,d){if(c instanceof Element&&d instanceof Element){if(c instanceof Relation&&d instanceof Relation){return false}if(this._elemA){this._elemA.delRelation(this)}if(this._elemB){this._elemB.delRelation(this)}this._elemA=c;this._elemB=d;this._elemA.addRelation(this);this._elemB.addRelation(this);this.updateParent();this._calculateLineEnds();return true}else{return false}};Relation.prototype.setElementA=function(b){if(b instanceof Element){if(b instanceof Relation&&this._elemB instanceof Relation){return false}if(this._elemA){this._elemA.delRelation(this)}this._elemA=b;this._elemA.addRelation(this);this.updateParent();return true}else{return false}};Relation.prototype.setElementB=function(b){if(b instanceof Element){if(b instanceof Relation&&this._elemA instanceof Relation){return false}if(this._elemB){this._elemB.delRelation(this)}this._elemB=b;this._elemB.addRelation(this);this.updateParent();return true}else{return false}};Relation.prototype.setValue=function(f,d){var e;for(e in this._components){if(this._components[e].getId()==f){this._components[e].setValue(d);this._updateComponents();return}}};Relation.prototype.addValue=function(f,d){var e;for(e in this._components){if(this._components[e] instanceof SuperComponent&&this._components[e].getId()==f){this._components[e].addField(d);this._updateComponents();return}}};Relation.prototype.getElementXML=function(h){var g=h.createElement(this.getType());g.setAttribute("id",this.getId());g.setAttribute("side_A",this._elemA.getId());g.setAttribute("side_B",this._elemB.getId());var e;for(e=0;e<this._points.length;e++){var f=h.createElement("point");f.setAttribute("x",this._points[e].getX());f.setAttribute("y",this._points[e].getY());g.appendChild(f)}for(e in this._components){if(this._components[e].getId()){g.appendChild(this._components[e].getComponentXML(h))}}return g};Relation.prototype.setElementXML=function(m,o){var q=m.getAttribute("side_A");var k=m.getAttribute("side_B");this.setElements(o[q],o[k]);var p;var n=m.childNodes;var l=0;for(p=0;p<n.length;p++){if(n[p].nodeName=="point"){this._points[l]=new Point(parseInt(n[p].getAttribute("x")),parseInt(n[p].getAttribute("y")));l++}}for(p=0;p<n.length;p++){if(n[p].nodeName=="item"){this.setValue(n[p].getAttribute("id"),n[p].getAttribute("value"))}else{if(n[p].nodeName=="superitem"){var j;for(j in this._components){if(this._components[j].getId()==n[p].getAttribute("id")){this._components[j].setComponentXML(n[p])}}}}}this._updateComponents()};Relation.prototype.setId=function(b){this._id=this.getType()+"_"+b};Relation.prototype.getId=function(){return this._id};Relation.prototype.setType=function(b){if(this._type=="untyped"&&JSFun.isString(b)){this._type=b}};Relation.prototype.getType=function(){return this._type};Relation.prototype.addRelation=function(b){if(b instanceof Relation){this._relations.push(b)}};Relation.prototype.delRelation=function(d){var c;for(c in this._relations){if(this._relations[c]==d){this._relations.splice(c,1);break}}};Relation.prototype.setDiagram=function(b){if(b instanceof Diagram){this._diagram=b}};Relation.prototype._addComponent=function(b){b.setParent(this);this._components.push(b);this._updateComponents()};Relation.prototype._delComponent=function(c){var d;for(d in this._components){if(this._components[d]==c){this._components.splice(d,1);break}}};Relation.prototype.setComponentName=function(b){if(!this._name){this._name=new TextBox({id:"name",text:b});this._addComponent(this._name)}else{this._name.setText(b)}};Relation.prototype.setStereotype=function(b){this._stereotype=new Text({id:"stereotype",text:b});this._addComponent(this._stereotype)};Relation.prototype.addComponentStereotype=function(b){if(!this._stereotype){this._stereotype=new StereotypeFields({id:"stereotype",width:100,text:b});this._addComponent(this._stereotype)}};Relation.prototype.setComponentRoleA=function(b){if(!this._roleA){this._roleA=new RoleItem({id:"roleA",text:b,margin:4});this._addComponent(this._roleA)}else{this._roleA.setText(b)}};Relation.prototype.setComponentRoleB=function(b){if(!this._roleB){this._roleB=new RoleItem({id:"roleB",text:b,margin:4});this._addComponent(this._roleB)}else{this._roleB.setText(b)}};Relation.prototype.setComponentMultiplicityA=function(b){if(!this._multiA){this._multiA=new TextBox({id:"multiplicityA",text:b,margin:4});this._addComponent(this._multiA)}else{this._multiA.setText(b)}};Relation.prototype.setComponentMultiplicityB=function(b){if(!this._multiB){this._multiB=new TextBox({id:"multiplicityB",text:b,margin:4});this._addComponent(this._multiB)}else{this._multiB.setText(b)}};Relation.prototype._updateComponents=function(){if(!(this._elemA&&this._elemB)){return}var v=this._points.length;var D=parseInt(v/2)-1;if(this._roleA){var H=this._points[0].getX();var I=this._points[0].getY();var t=this._points[1].getX();var u=this._points[1].getY();if(this._elemA instanceof Relation){this._roleA.setCoordinates(H,I-this._roleA.getHeight())}else{var B=Math.atan2(u-I,t-H);var G=Math.tan(B);var F=this._roleA.getWidth();var m=this._roleA.getHeight();var w;var y;if(H==this._elemA.getX()){w=-F;if(u<I){y=-m-G*F}else{y=-m}}else{if(H==this._elemA.getX()+this._elemA.getWidth()){w=0;if(u<I){y=-m+G*F}else{y=-m}}else{if(I==this._elemA.getY()){y=-m;if(t<H){w=-F-m/G}else{w=-F}}else{if(I==this._elemA.getY()+this._elemA.getHeight()){y=0;if(t<H){w=-F+m/G}else{w=-F}}}}}this._roleA.setCoordinates(H+w,I+y)}}if(this._roleB){var H=this._points[v-1].getX();var I=this._points[v-1].getY();var t=this._points[v-2].getX();var u=this._points[v-2].getY();if(this._elemB instanceof Relation){this._roleB.setCoordinates(H,I-this._roleB.getHeight())}else{var B=Math.atan2(u-I,t-H);var G=Math.tan(B);var F=this._roleB.getWidth();var m=this._roleB.getHeight();var w;var y;if(H==this._elemB.getX()){w=-F;if(u<I){y=-m-G*this._roleB.getWidth()}else{y=-m}}else{if(H==this._elemB.getX()+this._elemB.getWidth()){w=0;if(u<I){y=-m+G*this._roleB.getWidth()}else{y=-m}}else{if(I==this._elemB.getY()){y=-m;if(t<H){w=-F-this._roleB.getHeight()/G}else{w=-F}}else{if(I==this._elemB.getY()+this._elemB.getHeight()){y=0;if(t<H){w=-F+this._roleB.getHeight()/G}else{w=-F}}}}}this._roleB.setCoordinates(H+w,I+y)}}if(this._multiA){var H=this._points[0].getX();var I=this._points[0].getY();var t=this._points[1].getX();var u=this._points[1].getY();if(this._elemA instanceof Relation){this._multiA.setCoordinates(H,I)}else{var B=Math.atan2(u-I,t-H);var G=Math.tan(B);var F=this._multiA.getWidth();var m=this._multiA.getHeight();var w=0;var y=0;var A=this._elemA.getX()+this._elemA.getWidth()/2;var C=this._elemA.getY()+this._elemA.getHeight()/2;var x=H-A;var z=I-C;var E=(this._elemA.getHeight()/this._elemA.getWidth());if(x<0){if(z<0){if(z>E*x){w=-F;y=0}else{w=0;y=-m}}else{if(z>(-E)*x){w=0;y=0}else{w=-F;y=-G*F}}}else{if(z<0){if(z<(-E)*x){w=-m/G;y=-m}else{w=0;y=0}}else{if(z<E*x){w=0;y=G*F}else{w=m/G;y=0}}}this._multiA.setCoordinates(H+w,I+y)}}if(this._multiB){var H=this._points[v-1].getX();var I=this._points[v-1].getY();var t=this._points[v-2].getX();var u=this._points[v-2].getY();if(this._elemB instanceof Relation){this._multiB.setCoordinates(H,I)}else{var B=Math.atan2(u-I,t-H);var G=Math.tan(B);var F=this._multiB.getWidth();var m=this._multiB.getHeight();var w=0;var y=0;var A=this._elemB.getX()+this._elemB.getWidth()/2;var C=this._elemB.getY()+this._elemB.getHeight()/2;var x=H-A;var z=I-C;var E=(this._elemB.getHeight()/this._elemB.getWidth());if(x<0){if(z<0){if(z>E*x){w=-F;y=0}else{w=0;y=-m}}else{if(z>(-E)*x){w=0;y=0}else{w=-F;y=-G*F}}}else{if(z<0){if(z<(-E)*x){w=-m/G;y=-m}else{w=0;y=0}}else{if(z<E*x){w=0;y=G*F}else{w=m/G;y=0}}}this._multiB.setCoordinates(H+w,I+y)}}var H=this._points[D].getX();var I=this._points[D].getY();var t=this._points[D+1].getX();var u=this._points[D+1].getY();if(v%2!=0){var A=t;var C=u}else{var A=(H+t)/2;var C=(I+u)/2}if(this._stereotype){if(H>t&&I<u||t>H&&u<I){if(this._name){this._stereotype.setCoordinates(A-this._stereotype.getWidth(),C-this._stereotype.getHeight()-this._name.getHeight())}else{this._stereotype.setCoordinates(A-this._stereotype.getWidth(),C-this._stereotype.getHeight())}}else{if(this._name){this._stereotype.setCoordinates(A,C-this._stereotype.getHeight()-this._name.getHeight())}else{this._stereotype.setCoordinates(A,C-this._stereotype.getHeight())}}if(this._stereotype instanceof SuperComponent){this._stereotype.updateComponents()}}if(this._name){if(H>t&&I<u||t>H&&u<I){this._name.setCoordinates(A-this._name.getWidth(),C-this._name.getHeight())}else{this._name.setCoordinates(A,C-this._name.getHeight())}}};Relation.prototype._drawComponents=function(c){var d;for(d=0;d<this._components.length;d++){this._components[d].draw(c)}};Relation.prototype._drawComponentsShape=function(c){var d;for(d=0;d<this._components.length;d++){this._components[d].drawShape(c)}};Relation.prototype.isLinked=function(b){if(b instanceof Element&&(this._elemA==b||this._elemB==b)){return true}else{return false}};Relation.prototype._selectLine=function(m,x,D,E,B){if(!(m instanceof Point&&x instanceof Point)){return false}var B=B||5;var w=m.getX();var L=m.getY();var y=x.getX();var M=x.getY();var I,K,H,J;if(w>y){I=w;H=y}else{I=y;H=w}if(L>M){K=L;J=M}else{K=M;J=L}if(w==y){if(E<=K&&E>=J&&D>=H-B&&D<=H+B){return true}}else{var z,v,F,G;z=(M-L)/(y-w);v=Math.atan((M-L)/(y-w));F=Math.abs(Math.sin(v)*B);G=Math.abs(Math.cos(v)*B);if(D>=H-F&&D<=I+F&&E>=J-G&&E<=K+G){var C,A;C=(D-w)*z+L;A=Math.abs(E-C);A=Math.cos(v)*A;if(A<=B){return true}}}return false};Relation.prototype._isOverComponent=function(e,f){var d;for(d=0;d<this._components.length;d++){if(this._components[d].isOver(e,f)){return true}}return false};Relation.prototype._deselectComponent=function(){if(this._activeComponent){this._activeComponent.deselect();this._activeComponent=null}};Relation.prototype._selectComponent=function(e,f){var d;for(d=0;d<this._components.length;d++){if(this._components[d].select(e,f)){this._activeComponent=this._components[d];return}}};Relation.prototype.isOver=function(e,f){var d;for(var d=0;d<this._points.length-1;d++){if(this._selectLine(this._points[d],this._points[d+1],e,f,10)){return true}}return false};Relation.prototype.select=function(e,f){this._deselectComponent();for(d=0;d<this._points.length;d++){if(Math.abs(e-this._points[d].getX())<=4&&Math.abs(f-this._points[d].getY())<=4){if(this._selected>-1){this._selectedBefore=true}this._selected=d;this._selectedPoint=true;return true}}if(this._selected>-1){if(this._isOverComponent(e,f)){this._selectedBefore=true;return true}}for(var d=0;d<this._points.length-1;d++){if(this._selectLine(this._points[d],this._points[d+1],e,f)){if(this._selected>-1){this._selectedBefore=true}this._selected=d;this._selectedLine=true;this._points.splice(this._selected+1,0,new Point(e,f));return true}}return false};Relation.prototype.drag=function(d,c){if(this._selectedLine){if(this._elemA==this._elemB){this._selected=2;this._points[this._selected].setPoint(d,c)}else{this._points[this._selected+1].setPoint(d,c)}this._moved=true}else{if(this._selectedPoint){if(this._elemA==this._elemB){if(this._selected==1){this._points[this._selected].setY(c)}else{if(this._selected==3){this._points[this._selected].setX(d)}else{this._points[this._selected].setPoint(d,c)}}}else{this._points[this._selected].setPoint(d,c)}this._moved=true}}};Relation.prototype._checkForNewNodes=function(e,f){if(this._selectedPoint&&(this._selected==0||this._selected==this._points.length-1)){var d=this._diagram.reassignRelationTo(this,e,f);if(d!=this){if(this._selected==0){this.setElementA(d)}else{this.setElementB(d)}}}};Relation.prototype.drop=function(d,c){if(this._moved){this._checkForNewNodes(d,c)}else{if(this._selectedBefore){this._selectComponent(d,c)}}this._selectedLine=false;this._selectedPoint=false;this._moved=false;this._delUselessPoints();this.notifyChange()};Relation.prototype.notifyChange=function(){this._delUselessPoints();this.updateParent();this._calculateLineEnds();this._updateComponents();for(var b in this._relations){this._relations[b].notifyChange()}};Relation.prototype.notifyDraw=function(){if(this._diagram){this._diagram.draw()}};Relation.prototype.deselect=function(){this._deselectComponent();this._selectedBefore=false;this._selected=-1};Relation.prototype._calculateLineEnds=function(){var y,n;var t=this._points.length;if(this._elemA==this._elemB){var x=this._elemA.getCentralPoint();var v=x.getX();var w=x.getY();var p=(this._points[2])?this._points[2]._x:(this._elemA._x+this._elemA._width);var s=(this._points[2])?this._points[2]._y:(this._elemA._y+this._elemA._height);var u;var q;if(this._selected==2||this._selected==0||this._selected==t-1||(this._selected==-1&&!this._elemA._moved)||this._elemA._resizing){if((p-v)>0){if((s-w)>0){y=this._elemA.getLinkCentered(v,w+this._elemA.getHeight()/2);n=this._elemA.getLinkCentered(v+this._elemA.getWidth()/2,w);u=s-y.getY();u=(u<20)?20:u;q=p-n.getX();q=(q<20)?20:q;this._points[1]=new Point(v,y.getY()+u);this._points[2]=new Point(n.getX()+q,y.getY()+u);this._points[3]=new Point(n.getX()+q,w)}else{y=this._elemA.getLinkCentered(v,w-this._elemA.getHeight()/2);n=this._elemA.getLinkCentered(v+this._elemA.getWidth()/2,w);u=y.getY()-s;u=(u<20)?20:u;q=p-n.getX();q=(q<20)?20:q;this._points[1]=new Point(v,y.getY()-u);this._points[2]=new Point(n.getX()+q,y.getY()-u);this._points[3]=new Point(n.getX()+q,w)}}else{if((s-w)>0){y=this._elemA.getLinkCentered(v,w+this._elemA.getHeight()/2);n=this._elemA.getLinkCentered(v-this._elemA.getWidth()/2,w);u=s-y.getY();u=(u<20)?20:u;q=n.getX()-p;q=(q<20)?20:q;this._points[1]=new Point(v,y.getY()+u);this._points[2]=new Point(n.getX()-q,y.getY()+u);this._points[3]=new Point(n.getX()-q,w)}else{y=this._elemA.getLinkCentered(v,w-this._elemA.getHeight()/2);n=this._elemA.getLinkCentered(v-this._elemA.getWidth()/2,w);u=y.getY()-s;u=(u<20)?20:u;q=n.getX()-p;q=(q<20)?20:q;this._points[1]=new Point(v,y.getY()-u);this._points[2]=new Point(n.getX()-q,y.getY()-u);this._points[3]=new Point(n.getX()-q,w)}}}else{if(this._selected==3){p=this._points[3]._x;s=this._points[3]._y;y=this._elemA.getLinkCentered(v,this._points[0]._y);if((p-v)>0){n=this._elemA.getLinkCentered(v+this._elemA.getWidth()/2,w);q=p-n.getX();q=(q<20)?20:q;this._points[2].setX(n.getX()+q);this._points[3]=new Point(n.getX()+q,w)}else{n=this._elemA.getLinkCentered(v-this._elemA.getWidth()/2,w);q=n.getX()-p;q=(q<20)?20:q;this._points[2].setX(n.getX()-q);this._points[3]=new Point(n.getX()-q,w)}}else{if(this._selected==1){p=this._points[1]._x;s=this._points[1]._y;n=this._elemA.getLinkCentered(this._points[4]._x,w);if((s-w)>0){y=this._elemA.getLinkCentered(v,w+this._elemA.getHeight()/2);u=s-y.getY();u=(u<20)?20:u;this._points[1]=new Point(v,y.getY()+u);this._points[2].setY(y.getY()+u)}else{y=this._elemA.getLinkCentered(v,w-this._elemA.getHeight()/2);u=y.getY()-s;u=(u<20)?20:u;this._points[1]=new Point(v,y.getY()-u);this._points[2].setY(y.getY()-u)}}else{if(this._selected==-1){var o=0;var r=0;if(this._elemA._moved){var o=(this._elemA._x-this._elemA._prex)/2;var r=(this._elemA._y-this._elemA._prey)/2;this._points[0].setPoint(this._points[0]._x+o,this._points[0]._y+r);this._points[4].setPoint(this._points[4]._x+o,this._points[4]._y+r);y=this._points[0];n=this._points[4];this._points[1].setPoint(this._points[1]._x+o,this._points[1]._y+r);this._points[2].setPoint(this._points[2]._x+o,this._points[2]._y+r);this._points[3].setPoint(this._points[3]._x+o,this._points[3]._y+r)}}}}}this._points[0]=y;this._points[4]=n;while(this._points[5]){this._points.pop()}}else{if(t>2){y=this._elemA.getLinkCentered(this._points[1]);n=this._elemB.getLinkCentered(this._points[t-2]);this._points[0]=y;this._points[t-1]=n}else{y=this._elemA.getLinkCentered(this._elemB.getCentralPoint());n=this._elemB.getLinkCentered(this._elemA.getCentralPoint());this._points[0]=y;this._points[1]=n}}};Relation.prototype.draw=function(j){var l=this._points.length;if(this._line){this._line.draw(j,this._points,RelationStyle.line_color)}if(this._end){var p=this._points[l-2].getX();var q=this._points[l-2].getY();var m=this._points[l-1].getX();var o=this._points[l-1].getY();var n=Math.atan2(o-q,m-p);this._end.draw(j,m,o,n,RelationStyle.line_color)}if(this._start){var m=this._points[0].getX();var o=this._points[0].getY();var p=this._points[1].getX();var q=this._points[1].getY();var n=Math.atan2(o-q,m-p);this._start.draw(j,m,o,n,RelationStyle.line_color)}if(this._selected>=0){var k;for(k=0;k<this._points.length;k++){j.fillRect(parseInt(this._points[k].getX())-3,parseInt(this._points[k].pixelY())-3,6,6)}}if(this._selected>-1){this._drawComponentsShape(j)}this._drawComponents(j)};Relation.prototype.drawShape=function(c){if(!(this._selectedPoint&&this._selected==0||this._selected==this._points.length-1)){this._calculateLineEnds()}c.save();c.lineWidth=2;c.strokeStyle=RelationStyle.shape_color;c.beginPath();c.moveTo(this._points[0].pixelX(),this._points[0].pixelY());var d;for(var d=1;d<this._points.length;d++){c.lineTo(this._points[d].pixelX(),this._points[d].pixelY())}c.stroke();c.restore()};Relation.prototype.setParent=function(b){if(b instanceof Node){this._parent=b}else{this._parent=null}};Relation.prototype.updateParent=function(){if(this._parent){this._parent.delChild(this);this._parent=null}if(this._elemA&&this._elemB){if(this._elemA.getParent()!=null&&this._elemA.getParent()==this._elemB.getParent()){(this._elemA.getParent()).addChild(this)}else{if(this._elemA._parent&&this._elemB._parent&&this._elemA._parent._parent instanceof SuperNode&&this._elemB._parent._parent instanceof SuperNode&&this._elemA._parent._parent==this._elemB._parent._parent){(this._elemA.getParent().getParent()).addChild(this)}}}};Relation.prototype.updatePosition=function(f,e){var d;if(f==undefined&&e==undefined){this.notifyChange()}else{for(d=0;d<this._points.length;d++){this._points[d].setPoint(this._points[d].getX()+f,this._points[d].getY()+e)}for(d in this._components){this._components[d].updatePosition(f,e)}for(d in this._relations){if(this._relations[d]._parent!=this._parent){this._relations[d].notifyChange()}}}};Relation.prototype.setLine=function(b){if(b instanceof RelationLine){this._line=b}};Relation.prototype.setEnd=function(b){if(b instanceof RelationEnd){this._end=b}};Relation.prototype.setStart=function(b){if(b instanceof RelationEnd){this._start=b}};Relation.prototype.getParent=function(){return this._parent};Relation.prototype._delUselessPoints=function(){var d=this._points.length-1;if(this._elemA!=this._elemB){if(this._elemA instanceof Node){if(this._points[1]!=this._points[d]&&this._elemA.isOver(this._points[1])){this._points.shift();d-=1}}if(this._elemB instanceof Node){if(this._points[d-1]!=this._points[0]&&this._elemB.isOver(this._points[d-1])){this._points.pop()}}}var c;for(c=1;c<this._points.length-1;c++){if(this._selectLine(this._points[c-1],this._points[c+1],this._points[c].getX(),this._points[c].getY(),10)){this._points.splice(c,1)}}};Relation.prototype.getCentralPoint=function(){var g=parseInt(this._points.length/2)-1;var k=this._points[g].getX();var f=this._points[g].getY();var h=this._points[g+1].getX();var j=this._points[g+1].getY();return new Point((k+h)/2,(f+j)/2)};Relation.prototype.getLinkCentered=function(d,c){return this.getCentralPoint()};Relation.prototype.notifyDeleted=function(b){};Relation.prototype.deleted=function(){var b;while(this._relations[0]){(this._relations.pop()).deleted()}this._elemA.notifyDeleted(this);this._elemB.notifyDeleted(this);if(this._parent){this._parent.delChild(this)}this._diagram.notifyDeleted(this)};Relation.prototype.toString=function(){return"Relation"};var TextFields=function(b){b=b||{};TextFields.baseConstructor.call(this,b);this.setMinHeight(10);this.setMinWidth(25)};JSFun.extend(TextFields,SuperComponent);TextFields.prototype.isOver=function(d,c){if(this._visible&&this.visibilitySubComponents()&&Math.abs(d-(this._getX()+this.getWidth()-5))<=6&&Math.abs(c-(this._getY()+5))<=6){return true}else{return TextFields.base.isOver.call(this,d,c)}};TextFields.prototype.select=function(f,g){var h=(this._orientation)?(this._getX()+5):(this._getX()+this.getWidth()-5);var e=(this._orientation)?(this._getY()+this.getHeight()-5):(this._getY()+5);if(this.visibilitySubComponents()&&Math.abs(f-h)<=6&&Math.abs(g-e)<=6){this.addField();return true}else{return TextFields.base.select.call(this,f,g)}};TextFields.prototype.newItem=function(){return new TextBox()};TextFields.prototype.addField=function(c){var d=this.newItem();d.setDeletable();d.setValue(c);this.addSubComponent(d);this.notifyChange()};TextFields.prototype.drawShape=function(b){if(!this._visible){return}TextFields.base.drawShape.call(this,b);if(this.visibilitySubComponents()){b.save();b.fillStyle="#94dc91";b.beginPath();if(this._orientation){b.arc(this.getPixelX()+5,this.getPixelY()+this.getHeight()-5,4,0,Math.PI*2,true)}else{b.arc(this.getPixelX()+this.getWidth()-5,this.getPixelY()+5,4,0,Math.PI*2,true)}b.closePath();b.fill();b.restore()}};var StereotypeItem=function(b){b=b||{};StereotypeItem.baseConstructor.call(this,b);this._parse=/^\xAB(.*)\xBB$/;if(this._orientation){this.setMinHeight(40)}else{this.setMinWidth(40)}};JSFun.extend(StereotypeItem,TextBox);StereotypeItem.prototype.encode=function(c){var d="";if(c){d+="\xAB"+c+"\xBB"}if(this._parse.exec(d)){return d}else{return"wrong_stereotype"}};StereotypeItem.prototype.decode=function(c){var d=this._parse.exec(c);if(d){d.shift();return d[0]}else{return""}};var StereotypeFields=function(b){b=b||{};StereotypeFields.baseConstructor.call(this,b);this.setMinHeight(1);this.setMinWidth(1);this.setHeight(1);this.setWidth(1)};JSFun.extend(StereotypeFields,TextFields);StereotypeFields.prototype.newItem=function(){return new StereotypeItem({text:"\xABstereotype\xBB",orientation:this._orientation||0})};var Region=function(b){b=b||{};Region.baseConstructor.call(this,b);this.setType("Region");this._parent=b.parent||null;this.setContainer();if(b.addComponent!=false){this.addComponents()}};JSFun.extend(Region,Node);Region.prototype.addComponents=function(k){var k=(JSFun.isBoolean(k))?k:true;var m=this._parent._nodeChilds;var o=m.length;var n;if(o==0){if(this._parent._orientation){this.setWidth(this._parent._width)}else{this.setHeight(this._parent._height)}}if(this._parent._orientation){if(o>0&&k){m[o-1].setWidth(m[o-1].getWidth()/2);this._x=m[o-1].getX()+m[o-1].getWidth();this.setWidth(this._parent.getX()+this._parent.getWidth()-this._x)}if(!(this._parent instanceof Alternative)&&!(this._parent instanceof HierarchicalSwimlane)&&this._parent._includeComponentByRegion){this.addComponent(new StereotypeFields({id:"stereotypes",centered:true}));this.addComponent(new TextBox({id:"name_node",text:"region",margin:3,centered:true}))}if(o>0){var l=1;var h=this._parent.getHeight()-this._parent._components[0]._height-this._parent._components[1]._height;var j=this._parent._heightSmallRectangle||15;m[o-1].addComponent(new RegionLine({id:"region",margin:0,width:l,height:h,position:Component.TopRight,orientation:1}))}}else{if(o>0&&k){m[o-1].setHeight(m[o-1].getHeight()/2);this._y=m[o-1].getY()+m[o-1].getHeight();this.setHeight(this._parent.getY()+this._parent.getHeight()-this._y)}if(this._parent instanceof Alternative){this.addComponent(new StereotypeFields({id:"stereotypes"}));this.addComponent(new GuardItem({id:"description",text:"[]",margin:1}))}if(!(this._parent instanceof Alternative)&&!(this._parent instanceof HierarchicalSwimlane)&&this._parent._includeComponentByRegion){this.addComponent(new StereotypeFields({id:"stereotypes",centered:true}));this.addComponent(new TextBox({id:"name_node",text:"region",margin:3,centered:true}))}if(o>0){var h=1;var l=this._parent.getWidth();m[o-1].addComponent(new RegionLine({id:"region",margin:0,width:l,height:h,position:Component.BottomLeft,orientation:0}))}}};Region.prototype.updateContainer=function(C){if(!(C==false||C==true)){C=true}if(this._container){var w;var B=this._x;var D=this._y;var E=this._x;var F=this._y;var A;var t,u,v,x;for(w in this._nodeChilds){A=this._nodeChilds[w];if(A._visible){v=A._x;x=A._y;t=A._x+A._width;u=A._y+A._height;if(t>E){E=t}if(u>F){F=u}if(v<B){B=v}if(x<D){D=x}}}for(w=this._components.length;w--;){if(this._components[w] instanceof RegionLine){break}}if(w!=-1){if(this.getParent()._orientation){E+=this._components[w]._width+2}else{F+=this._components[w]._height+2}}var z=-1;var s=-1;if(this.getParent()._orientation){if((B<this._x)||(E>(this._x+this._width))){var y;for(w=0;w<this.getParent()._nodeChilds.length;w++){var r=this.getParent()._nodeChilds[w];if((r.getX()+r.getWidth())>B){if(z==-1){z=w}}if((r.getX())<E){s=w}}if((z!=-1)&&(B<this._x)){y=this._x-B+this.getParent().getWidth();this.getParent()._x=this.getParent()._x-(this._x-B);this.getParent().setWidth(y)}if(E>(this._x+this._width)){y=E-this._x-this._width+this.getParent().getWidth();this.getParent().setWidth(y)}}}else{if((D<this._y)||(F>(this._y+this._height))){for(w=0;w<this.getParent()._nodeChilds.length;w++){var r=this.getParent()._nodeChilds[w];if((r.getY()+r.getHeight())>D){if(z==-1){z=w}}if((r.getY())<F){s=w}}var G;if((z!=-1)&&(D<this._y)){G=this._y-D+this.getParent().getHeight();this.getParent()._y=this.getParent()._y-(this._y-D);this.getParent().setHeight(G)}if(F>(this._y+this._height)){G=F-this._y-this._height+this.getParent().getHeight();this.getParent().setHeight(G)}}}if(B<this._x||D<this._y){this.setWidth(this._x-B+this._width);this.setHeight(this._y-D+this._height);this._x=B;this._y=D;this.setMinWidth(E-B);this.setMinHeight(F-D)}else{this.setMinWidth(E-this._x);this.setMinHeight(F-this._y)}this._prex=this._x;this._prey=this._y;this.updateComponents();if(this._parent&&C){this._parent.updateContainer()}}};Region.prototype.isOverRegionLine=function(e,f){var d;for(d=0;d<this._components.length;d+=1){if(this._components[d] instanceof RegionLine&&this._components[d].isOver(e,f)){return true}}return false};var Diagram=function(b){this._alone=false;this._width=0;this._height=0;this._background="#ffffff";this._div=null;this._mainContext=null;this._motionContext=null;this._nodes=[];this._relations=[];this._pressMouse=false;this._pressMouseRight=false;this._pressKey=false;this._validElements=[];this._items=[];this._id;this._type="untyped";this._activeMenu=false;this._visible=true;this._name=new Tab({text:"Diagram name",margin:6});this._name.setCoordinates(0,0);this._name.setParent(this);if(b){if(b.backgroundNodes){this._backgroundNodes=b.backgroundNodes}if(b.background){this._background=b.background}if(b.id){this._alone=true;this._generateStructure(b.id,b.width,b.height)}}this._element=null;this._lastElement=null;this._defineDragAndDrop();this._updateCanvas=false;this._selected=true};Diagram.prototype._generateStructure=function(f,j,g){if(!j||j<0){j=300}if(!g||g<0){g=100}this._width=j;this._height=g;var h=document.getElementById(f);if(h==null||h.nodeName!="DIV"){throw {name:"NotCorrectId",message:"The id specified does not exist or not a div element"}}h.setAttribute("class","ud_diagram_div");h.style.width=j+"px";h.style.height=g+"px";this._div=h;var k=document.createElement("canvas");k.setAttribute("class","ud_diagram_canvas");k.width=j;k.height=g;this._mainContext=k.getContext("2d");h.appendChild(k);k=document.createElement("canvas");k.setAttribute("class","ud_diagram_canvas");k.width=this._width;k.height=this._height;k.onmousedown=function(){return false};this._motionContext=k.getContext("2d");h.appendChild(k);return true};Diagram.prototype.initialize=function(j,k,g,l,m,h){if(JSFun.isNumber(j)&&k.nodeName=="DIV"&&g instanceof CanvasRenderingContext2D&&l instanceof CanvasRenderingContext2D&&m>0&&h>0){this._id=j;this._div=k;this._mainContext=g;this._motionContext=l;this._width=m;this._height=h;return true}else{return false}};Diagram.prototype.select=function(){this._selected=true};Diagram.prototype.deselect=function(){this._selected=false};Diagram.prototype.getId=function(){return this._id};Diagram.prototype.setId=function(b){this._id=b};Diagram.prototype.getName=function(){return this._name.getValue()};Diagram.prototype.setName=function(b){if(JSFun.isString(b)){this._name.setValue(b)}};Diagram.prototype.setType=function(b){if(this._type=="untyped"&&JSFun.isString(b)){this._type=b}};Diagram.prototype.getType=function(){return this._type};Diagram.prototype.notifyDraw=function(){this.draw()};Diagram.prototype.notifyChange=function(){this.draw()};Diagram.prototype._addElementOnly=function(b){if(b instanceof Node){b.setDiagram(this);this._nodes.push(b)}else{if(b instanceof Relation){b.setDiagram(this);this._relations.push(b)}}};Diagram.prototype.addElement=function(c){if(!c||!(c instanceof Element)){return false}var d;for(d in this._validElements){if(c.getType()==this._validElements[d]){if(c instanceof Node){this._addNode(c);return true}else{if(c instanceof Relation){this._addRelation(c);return true}}}}return false};Diagram.prototype._addNode=function(f){if(f instanceof Node){f.setDiagram(this);if(f instanceof SuperNode){for(var d=0;d<f._nodeChilds.length;d++){f._nodeChilds[d].setDiagram(this)}}this._nodes.push(f);if(this._backgroundNodes){f.setBackgroundColor(this._backgroundNodes)}if(!f.isAlone()){this.checkForParent(f)}f.updatePosition();if(f.getParent()){f._parent.updateContainer();var e=f._parent.getParent();while(e){if(e instanceof SuperNode){e.notifyChange(true);e=null}else{e=e._parent}}}this._sortNodesByArea()}};Diagram.prototype.setBackgroundNodes=function(b){if(b){this._backgroundNodes=b}};Diagram.prototype.delElement=function(c){var d;for(d in this._nodes){if(this._nodes[d]==c){c.deleted();return true}}for(d in this._relations){if(this._relations[d]==c){c.deleted();return true}}return false};Diagram.prototype.notifyDeleted=function(c){var d;if(c instanceof Relation){for(d in this._relations){if(this._relations[d]==c){this._relations.splice(d,1);return}}}else{if(c instanceof Node){for(d in this._nodes){if(this._nodes[d]==c){this._nodes.splice(d,1);return}}}}};Diagram.prototype._addRelation=function(b){if(b instanceof Relation){b.setDiagram(this);this._relations.push(b)}};Diagram.prototype.addRelationFromPoints=function(h,m,k,n,l){var o=this.getElementByPoint(m,k);var j=this.getElementByPoint(n,l);if(o&&j){if(h.setElements(o,j)){h.notifyChange();this.addElement(h)}}};Diagram.prototype._clearMain=function(){this._mainContext.clearRect(0,0,this._width,this._height);this._mainContext.save();this._mainContext.fillStyle=this._background;this._mainContext.fillRect(0,0,this._width,this._height);this._mainContext.restore()};Diagram.prototype._clearMotion=function(){this._motionContext.clearRect(0,0,this._width,this._height)};Diagram.prototype.draw=function(){if(!this._mainContext){return}this._clearMain();this.updateHeightCanvas();this._name.draw(this._mainContext);for(i=this._nodes.length-1;i>=0;i-=1){this._nodes[i].draw(this._mainContext)}for(i in this._relations){this._relations[i].draw(this._mainContext)}};Diagram.prototype.updateHeightCanvas=function(){if(!this._updateCanvas){return}var d;var c=0;for(d=this._nodes.length-1;d>=0;d-=1){if((this._nodes[d]._y+this._nodes[d]._height+10)>c){c=this._nodes[d]._y+this._nodes[d]._height+10}}if(c>this._height){this._div.style.height=c+"px";this._div.childNodes[0].height=c;this._div.childNodes[1].height=c;this._mainContext.canvas.height=c;this._motionContext.canvas.height=c;this._clearMotion();this._height=c}else{c=(c>580)?c:580;this._div.style.height=c+"px";this._div.childNodes[0].height=c;this._div.childNodes[1].height=c;this._mainContext.canvas.height=c;this._motionContext.canvas.height=c;this._clearMotion();this._height=c}};Diagram.prototype.setUpdateHeightCanvas=function(b){this._updateCanvas=b};Diagram.prototype._drawMotion=function(b){this._clearMotion();b.drawShape(this._motionContext)};Diagram.prototype._sortNodesByArea=function(){this._nodes.sort(function(b,h){var a=b.getArea();var g=h.getArea();if(a<g){return -1}else{if(a==g){return 0}else{return 1}}})};Diagram.prototype.getElementByPoint=function(f,g){var h,e;for(h in this._relations){if(this._relations[h].isOver(f,g)){return this._relations[h]}}for(h=0;h<this._nodes.length;h++){if(this._nodes[h].isOver(f,g)){return this._nodes[h]}}return null};Diagram.prototype.reassignRelationTo=function(e,f,g){var h;for(h in this._relations){if(this._relations[h]!=e&&this._relations[h].isOver(f,g)){return this._relations[h]}}for(h=0;h<this._nodes.length;h++){if(this._nodes[h].isOver(f,g)){return this._nodes[h]}}return null};Diagram.prototype.checkForParent=function(p){if(p instanceof Node){var o;var l;var s;var j=false;var n=false;var m=p.getParent();for(o=0;o<this._nodes.length&&!j;o++){l=this._nodes[o];if(l instanceof SuperNode){for(var q=0;q<l._nodeChilds.length&&!j;q++){s=l._nodeChilds[q];if(s.isContainer()&&s!=p&&s.isOver(p.getCentralPoint())&&(!p.isContainer()||(p.isContainer()&&!s.isChildOf(p)))){j=true;l=s;break}}}else{if(l.isContainer()&&l!=p&&l.getArea()>p.getArea()&&l.isOver(p.getCentralPoint())&&(!p.isContainer()||(p.isContainer()&&!l.isChildOf(p)))){j=true;break}}}if(j){if(l==m){}else{if(m){m.delChild(p);m.updateContainer();l.addChild(p)}else{l.addChild(p)}}}else{if(m){m.delChild(p);m.updateContainer();var r=m.getParent();if(r instanceof SuperNode){r.notifyChange(true)}}}}};Diagram.prototype._defineDragAndDrop=function(){var b=this;this._element=null;this._lastElement=null;this._selectElement=function(h){if(h.button!=0){if(h.button==2){b._pressMouseRight=true}else{b._pressKey=true;return}}else{b._pressMouse=true}var j=h.pageX-b._div.offsetLeft;var k=h.pageY-b._div.offsetTop;var g=false;var a;if(b._lastElement instanceof Relation){if(b._lastElement.select(j,k)){b._element=b._lastElement;g=true}}for(a=0;a<b._relations.length&&!g;a++){if(b._relations[a].select(j,k)){b._element=b._relations[a];g=true}}for(a=0;a<b._nodes.length&&!g;a++){if(b._nodes[a].select(j,k)){b._element=b._nodes[a];g=true}}if(b._alone){b._name.deselect();if(!g&&b._name.select(j,k)){g=true}}if(b._lastElement&&b._lastElement!=b._element){b._lastElement.deselect();b._lastElement=null}};this._dragElement=function(e){if(!(e.button==0&&b._pressMouse)){return}if(b._element){var f=e.pageX-b._div.offsetLeft;var a=e.pageY-b._div.offsetTop;if(f<0){f=0}if(a<0){a=0}if(f>=b._width){f=b._width}if(a>=b._height){a=b._height}b._div.style.cursor="pointer";b._element.drag(f,a);b._drawMotion(b._element)}};this._dropElement=function(e){if(!(e.button==0&&b._pressMouse)){return}if(b._element){b._div.style.cursor="default";b._clearMotion();var f=e.pageX-b._div.offsetLeft;var a=e.pageY-b._div.offsetTop;b._element.drop(f,a);b._lastElement=b._element;b._element=null;b._sortNodesByArea();b.draw()}else{b.draw()}b._pressMouse=false};this._suprElement=function(a){if(a.keyCode!=46){return}if(b._lastElement){b.delElement(b._lastElement);b._lastElement=null;b.draw()}};this.stopEvents=function(){this._name.deselect();if(b._lastElement){b._lastElement.deselect();b._lastElement=null}}};Diagram.prototype.setVisibility=function(b){this._visible=b;if(!b){this.interaction(false)}};Diagram.prototype.isVisible=function(){return this._visible};Diagram.prototype.interaction=function(b){if(b){this._div.addEventListener("mousedown",this._selectElement,false);window.addEventListener("mousemove",this._dragElement,false);window.addEventListener("mouseup",this._dropElement,false);this._div.addEventListener("touchstart",this._selectElement,false);window.addEventListener("touchmove",this._dragElement,false);window.addEventListener("touchend",this._dropElement,false)}else{this.stopEvents();this._div.removeEventListener("mousedown",this._selectElement,false);window.removeEventListener("mousemove",this._dragElement,false);window.removeEventListener("mouseup",this._dropElement,false)}};Diagram.prototype._enumerateElements=function(){var d;var e=0;var f=0;for(d=0;d<this._nodes.length;d++){if(d>f){f=d}this._nodes[d].setId(f);if(this._nodes[d] instanceof SuperNode){for(e=f+1;e<this._nodes[d]._nodeChilds.length+f+1;e++){this._nodes[d]._nodeChilds[e-f-1].setId(e)}f=e}else{if(d!=f){f=f+1}}}for(d=0;d<this._relations.length;d++){this._relations[d].setId(d)}};Diagram.prototype.getXML=function(k){this._enumerateElements();this._sortNodesByArea();if(this._alone){var k=(new DOMParser()).parseFromString("<"+this.getType()+"/>","text/xml");var g=k.getElementsByTagName(this.getType())[0]}else{var g=k.createElement(this.getType())}g.setAttribute("name",this._name.getValue());if(this._backgroundNodes){g.setAttribute("backgroundNodes",this._backgroundNodes)}var h;var f;for(f=this._nodes.length-1;f>=0;f--){if(this._nodes[f].getParent()==null&&this._nodes[f]._action==undefined){g.appendChild(this._nodes[f].getElementXML(k))}}var j;for(f=0;f<this._relations.length;f++){if(!this._relations[f].getParent()){g.appendChild(this._relations[f].getElementXML(k))}}return g};Diagram.prototype.getXMLString=function(){return(new XMLSerializer()).serializeToString(this.getXML())};Diagram.prototype.setXML=function(f){var h=[];if(this._alone){var g=f.getElementsByTagName(this.getType())[0];if(!g){return false}}else{var g=f}this._name.setValue(g.getAttribute("name"));if(g.getAttribute("backgroundNodes")){this._backgroundNodes=g.getAttribute("backgroundNodes")}var j=g.childNodes;var k;for(k=0;k<j.length;k++){this._instantiateElements(j[k],h)}for(k=0;k<j.length;k++){this._addElementXML(j[k],h)}for(k=0;k<this._relations.length;k++){this._relations[k].notifyChange()}this._sortNodesByArea();return true};Diagram.prototype.setXMLString=function(c){if(!c||!JSFun.isString(c)){return false}c=c.replace(/\n/gi,"");var d=(new DOMParser()).parseFromString(c,"text/xml");if(d==null){return null}return this.setXML(d)};Diagram.prototype._addElementXML=function(l,m,n){var n=n||null;var k=m[l.getAttribute("id")];if(k){if(n instanceof SuperNode&&k instanceof Region){k.addComponents(false)}if(n instanceof SuperNode&&k instanceof Node){k.setDiagram(this)}else{this._addElementOnly(k)}k.setElementXML(l,m);if(n instanceof SuperNode&&k instanceof Node){if(k instanceof Region){var h=k._parent._nodeChilds;var j=h.length;if(j>0){if(k._parent._orientation){h[j-1].setWidth(k._x-h[j-1]._x)}else{h[j-1].setHeight(k._y-h[j-1]._y)}h[j-1].updateComponents()}}}if(n&&k instanceof Node){n.addChild(k);if(k instanceof Swimlane){k._parent.updateSizeComponentSwimlane()}n.updateContainer(false);if(n._parent instanceof SuperNode){n._parent.updateContainer(false)}}for(var o=0;o<l.childNodes.length;o++){this._addElementXML(l.childNodes[o],m,k)}}};Diagram.prototype._instantiateElements=function(j,k,f){f=f||null;var h=this._instantiateObjectFromString(j.nodeName,f);if(h){k[j.getAttribute("id")]=h;var g;for(g=0;g<j.childNodes.length;g++){if(h instanceof SuperNode&&j.childNodes[g].nodeName=="Region"){this._instantiateElements(j.childNodes[g],k,h)}else{this._instantiateElements(j.childNodes[g],k)}}}};Diagram.prototype.setValidElements=function(c){this._validElements=[];var d;for(d in c){if(JSFun.isString(c[d])){this._validElements.push(c[d])}}};Diagram.prototype.getValidElements=function(){if(this._validElements){return this._validElements}};Diagram.prototype._instantiateObjectFromString=function(elemName,parent){if(JSFun.isString(elemName)){parent=parent||null;var i;for(i in this._validElements){if(elemName==this._validElements[i]){if(elemName=="UMLAlternative"||elemName=="UMLHorizontalRegion"||elemName=="UMLVerticalRegion"||elemName=="UMLCompositeState"){var setElementXml=true;return eval("new "+this._validElements[i]+"({ setElementXml: "+setElementXml+"})")}else{if(parent){return(new window[this._validElements[i]]({addComponent:false,parent:parent}))}else{return eval("new "+this._validElements[i]+"()")}}}}}else{return null}};var Dialog=function(b){b=b||{};this._text=b.text||"";this._cancelable=b.cancelable||false;this._active=false};Dialog.prototype.show=function(r,o){var o=o||null;if(this._active){return}this._active=true;if(!(typeof this._text==="string")){return false}that=this;var u=document.createElement("div");u.className="ud_popup";var t=document.createElement("form");var q=document.createElement("input");q.setAttribute("type","submit");q.setAttribute("value","ok");var s;var l;l=document.createElement("div");l.appendChild(document.createTextNode(this._text));if(o){var n=document.createElement("div");var t=document.createElement("form");var p;p=document.createElement("input");p.setAttribute("type","text");p.setAttribute("value",o);n.appendChild(p);t.appendChild(n)}this.acceptText=function(a){document.body.removeChild(u);(o)?r(p.value):r();that._active=false};q.addEventListener("click",this.acceptText,false);t.onsubmit=function(){return false};t.appendChild(q);if(this._cancelable){var m=document.createElement("input");m.setAttribute("type","submit");m.setAttribute("value","cancel");this.deleteDialog=function(a){document.body.removeChild(u);that._active=false};m.addEventListener("click",this.deleteDialog,false);t.appendChild(m)}u.appendChild(l);u.appendChild(t);document.body.appendChild(u);q.focus();u.style.top=(window.innerHeight-t.offsetHeight)/2+"px";u.style.left=(window.innerWidth-t.offsetWidth)/2+"px";return true};var Elliptical=function(b){b=b||{};Elliptical.baseConstructor.call(this,b)};JSFun.extend(Elliptical,Node);Elliptical.prototype.isOver=function(h,j){if(h instanceof Point){j=h.getY();h=h.getX()}var l=this.getWidth()/2;var k=this.getHeight()/2;var m=Math.abs(h-this.getX()-l);var g=Math.abs(j-this.getY()-k);if(m<=l){if(Math.abs(Math.sqrt((1-(m*m)/(l*l))*k*k))>=g){return true}}};Elliptical.prototype.getParticularWidth=function(a){if(a>=this.getY()&&a<=this.getY()+this.getHeight()){var l=this.getWidth()/2;var m=this.getHeight()/2;var b=this.getY()+m-a;var n=this.getX()+l;var k=l*Math.sqrt(1-(b*b)/(m*m));var o=1-(a*a)/(m*m);return[n-k,2*k]}return[0,0]};Elliptical.prototype.getLinkCentered=function(l,a){if(l instanceof Point){a=l.getY();l=l.getX()}var k=this.getWidth()/2;var m=this.getHeight()/2;var b=this.getX()+k;var j=this.getY()+m;return JSGraphic.ellipseIntersection(b,j,k,m,l,a)};Elliptical.prototype.calculateSize=function(){var g;var j=0;var k=0;var f;var h=false;for(f=0;f<this._components.length;f++){g=this._components[f];if(g._visible){if(g.getPosition()==Component.Float){k+=g.getHeight();if(g.getWidth()>j){j=g.getWidth()}}}else{if(!g._visible){h=true}}}if(k==0&&h==true){k=20}if(j==0&&h==true){j=20}if(k>0){this.setMinHeight(k*1.447716)}if(j>0){this.setMinWidth(j*1.447716)}};Elliptical.prototype.updateComponents=function(){if(this._components.length>0){this.calculateSize();var l=this.getX();var m=this.getY();var o=this.getWidth()/2;var p=this.getHeight()/2;var q=l+o;var a=m+p;var b=JSGraphic.ellipseIntersection(q,a,o,p,l,m);this.insertComponents(b.getX(),b.getY(),this.getWidth()-2*(b.getX()-this.getX()),this.getHeight()-2*(b.getY()-this.getHeight()));var n;for(n in this._relations){this._relations[n].notifyChange()}}};var TextArea=function(b){b=b||{};TextArea.baseConstructor.call(this,b);this.setText(b.text||"");this._active=false};JSFun.extend(TextArea,Component);TextArea.prototype.showDialog=function(){var m=this;this._active=true;var j=document.createElement("div");var g=document.createElement("form");var k=document.createElement("textarea");var h=document.createElement("input");var l=document.createElement("input");j.className="ud_popup";k.setAttribute("rows",5);k.setAttribute("cols",30);k.value=this._text.join("\n");h.setAttribute("type","submit");h.setAttribute("value","ok");l.setAttribute("type","submit");l.setAttribute("value","no");this.changeText=function(a){if(m._active){m.setText(k.value);document.body.removeChild(j);m._active=false;m.notifyChange()}};this.closeDialog=function(a){if(m._active){document.body.removeChild(j);m._active=false;m.notifyChange()}};g.onsubmit=function(){return false};h.addEventListener("click",this.changeText,false);l.addEventListener("click",this.closeDialog,false);g.appendChild(k);g.appendChild(h);g.appendChild(l);j.appendChild(g);document.body.appendChild(j);k.focus();j.style.top=(window.innerHeight-g.offsetHeight)/2+"px";j.style.left=(window.innerWidth-g.offsetWidth)/2+"px"};TextArea.prototype.setText=function(g){if(JSFun.isString(g)){var e,h=0;var f=g.split("\n");for(e=0;e<f.length;e++){if(f[e].length>h){h=f[e].length}}this._text=f;if(g==""){this.setWidth(40)}else{this.setWidth(h*ComponentStyle.font_width)}this.setHeight(this._text.length*ComponentStyle.line_height)}};TextArea.prototype.setValue=function(b){b=b.replace(/;/gi,"\n");this.setText(b)};TextArea.prototype.getValue=function(){return this._text.join(";")};TextArea.prototype.select=function(d,c){if(!this._active&&this.isOver(d,c)){this.showDialog(d,c);return true}else{return false}};TextArea.prototype.draw=function(l){if(!this._visible){return}l.save();if(this._active){l.fillStyle="#ffc485";l.fillRect(this._getX(),this._getY(),this.getWidth(),this.getHeight())}l.font=ComponentStyle.font_size+" monospace";l.textBaseline="middle";l.fillStyle=ComponentStyle.text_color;var h=this._getMX();var j=this._getMY()+ComponentStyle.line_height/2;var g=this.getWidth()-2*this._getMargin();var k=0;var m;for(m=0;m<this._text.length;m++){k=h+g/2-(this._text[m].length*ComponentStyle.font_width)/2;l.fillText(this._text[m],k,j);j+=ComponentStyle.line_height}l.restore()};TextArea.prototype.drawShape=function(b){if(!this._visible){return}b.save();b.strokeStyle="#aaaaaa";b.strokeRect(this.getPixelX(),this.getPixelY(),this.getWidth(),this.getHeight());b.restore()};TextArea.prototype.deselect=function(){if(this._active){this.closeDialog();this._active=false}};var GuardItem=function(b){b=b||{};GuardItem.baseConstructor.call(this,b);this._parse=/^(?:\[([^\[\]\;]*)\])?$/;this.setMinWidth(15)};JSFun.extend(GuardItem,TextArea);GuardItem.prototype.encode=function(c){var d="[]";if(c){d="["+c+"]"}if(this._parse.exec(d)){return d}else{return"wrong_operation"}};GuardItem.prototype.decode=function(c){var d=this._parse.exec(c);if(d){d.shift();return d}else{return[]}};GuardItem.prototype.showDialog=function(){var m=this;if(this.active){return}this._active=true;var j=document.createElement("div");j.className="ud_popup";var g=document.createElement("form");var k=document.createElement("textarea");k.setAttribute("rows",5);k.setAttribute("cols",30);var h=document.createElement("input");h.setAttribute("type","submit");h.setAttribute("value","ok");var l=document.createElement("input");l.setAttribute("type","submit");l.setAttribute("value","no");k.value=this.decode(this._text.join("\n"));this.changeText=function(a){if(m._active){m.setText(m.encode(k.value));document.body.removeChild(j);m._active=false;m.notifyChange()}};this.closeDialog=function(a){if(m._active){document.body.removeChild(j);m._active=false;m.notifyChange()}};g.onsubmit=function(){return false};h.addEventListener("click",this.changeText,false);l.addEventListener("click",this.closeDialog,false);g.appendChild(k);g.appendChild(h);g.appendChild(l);j.appendChild(g);document.body.appendChild(j);k.focus();j.style.top=(window.innerHeight-g.offsetHeight)/2+"px";j.style.left=(window.innerWidth-g.offsetWidth)/2+"px"};GuardItem.prototype.draw=function(j){if(!this._visible){return}j.save();if(this._active){j.fillStyle="#ffc485";j.fillRect(this._getX(),this._getY(),this.getWidth(),this.getHeight())}j.font=ComponentStyle.font_size+" monospace";j.textBaseline="middle";j.fillStyle=ComponentStyle.text_color;var g=this._getMX();var h=this._getMY()+ComponentStyle.line_height/2;var f=this.getWidth()-2*this._getMargin();var k;for(k=0;k<this._text.length;k++){j.fillText(this._text[k],g,h);h+=ComponentStyle.line_height}j.restore()};var Tab=function(b){b=b||{};Tab.baseConstructor.call(this,b)};JSFun.extend(Tab,TextBox);Tab.prototype.draw=function(d){if(!this._visible){return}Tab.base.draw.call(this,d);var e=this.getPixelX();var f=this.getPixelY();d.beginPath();d.moveTo(e,f+this.getHeight());d.lineTo(e+this.getWidth()-4,f+this.getHeight());d.lineTo(e+this.getWidth(),f);d.stroke()};var LoopItem=function(b){b=b||{};LoopItem.baseConstructor.call(this,b);this._parse=/^LOOP(?:[\(]?([0-9 ]*)[\,]?)(?:([0-9 ]*)[\)]?)?$/};JSFun.extend(LoopItem,Tab);LoopItem.prototype.encode=function(d){var c="LOOP";if(d[0]){c+="("+d[0]}if(d[1]){if(!d[0]){c+="("+0}c+=","+d[1]+")"}else{if(d[0]){c+=")"}}if(this._parse.exec(c)){return c}else{return"wrong_operation"}};LoopItem.prototype.decode=function(c){var d=this._parse.exec(c);if(d){d.shift();return d}else{return[]}};LoopItem.prototype.showDialog=function(){if(this.active){return}var r=this;this.active=true;var w=document.createElement("div");w.className="ud_popup";var v=document.createElement("form");var s=[];var u;for(u=0;u<2;u++){s.push(document.createElement("input"))}var q=document.createElement("input");q.setAttribute("type","submit");q.setAttribute("value","ok");var o=this.decode(this.getValue());for(u=0;u<s.length;u++){s[u].setAttribute("type","text");s[u].setAttribute("value",o[u]||"")}this.changeText=function(b){if(r.active){var a=[];var c;for(c=0;c<s.length;c++){a.push(s[c].value)}r.setText(r.encode(a));document.body.removeChild(w);r.active=false;r.notifyChange()}};v.onsubmit=function(){return false};q.addEventListener("click",this.changeText,false);var t=["initial value","end value"];var p;var m;for(u=0;u<s.length;u++){m=document.createElement("div");p=document.createElement("label");p.appendChild(document.createTextNode(t[u]));m.appendChild(p);m.appendChild(s[u]);v.appendChild(m)}v.appendChild(q);if(this.deletable){var n=document.createElement("input");n.setAttribute("type","submit");n.setAttribute("value","delete");this.deleteDialog=function(a){if(r.active){document.body.removeChild(w);r.active=false;r.notifyDelete();r.notifyChange()}};n.addEventListener("click",this.deleteDialog,false);v.appendChild(n)}w.appendChild(v);document.body.appendChild(w);q.focus();w.style.top=(window.innerHeight-v.offsetHeight)/2+"px";w.style.left=(window.innerWidth-v.offsetWidth)/2+"px"};var ObjectItem=function(b){b=b||{};ObjectItem.baseConstructor.call(this,b);this._parse=/^([a-zA-Z]*)(?:\:([^\:\{\}]*))?(?:\{([a-zA-Z]*)\})?$/};JSFun.extend(ObjectItem,TextBox);ObjectItem.prototype.encode=function(d){var c="";if(d[0]){c+=d[0]}if(d[1]){c+=":"+d[1]}if(d[2]){c+="{"+d[2]+"}"}if(this._parse.exec(c)){return c}else{return"wrong_operation"}};ObjectItem.prototype.decode=function(c){var d=this._parse.exec(c);if(d){d.shift();return d}else{return[]}};ObjectItem.prototype.showDialog=function(){if(this.active){return}var r=this;this.active=true;var w=document.createElement("div");w.className="ud_popup";var v=document.createElement("form");var s=[];var u;for(u=0;u<3;u++){s.push(document.createElement("input"))}var q=document.createElement("input");q.setAttribute("type","submit");q.setAttribute("value","ok");var o=this.decode(this.getValue());for(u=0;u<s.length;u++){s[u].setAttribute("type","text");s[u].setAttribute("value",o[u]||"")}this.changeText=function(b){if(r.active){var a=[];var c;for(c=0;c<s.length;c++){a.push(s[c].value)}r.setText(r.encode(a));document.body.removeChild(w);r.active=false;r.notifyChange()}};this.closeDialog=function(a){if(r.active){document.body.removeChild(w);r.active=false;r.notifyChange()}};v.onsubmit=function(){return false};q.addEventListener("click",this.changeText,false);var t=["name","class","state"];var p;var m;for(u=0;u<s.length;u++){m=document.createElement("div");p=document.createElement("label");p.appendChild(document.createTextNode(t[u]));m.appendChild(p);m.appendChild(s[u]);v.appendChild(m)}v.appendChild(q);if(this.deletable){var n=document.createElement("input");n.setAttribute("type","submit");n.setAttribute("value","delete");this.deleteDialog=function(a){if(r.active){document.body.removeChild(w);r.active=false;r.notifyDelete();r.notifyChange()}};n.addEventListener("click",this.deleteDialog,false);v.appendChild(n)}w.appendChild(v);document.body.appendChild(w);q.focus();w.style.top=(window.innerHeight-v.offsetHeight)/2+"px";w.style.left=(window.innerWidth-v.offsetWidth)/2+"px"};var OperationItem=function(b){b=b||{};OperationItem.baseConstructor.call(this,b);this._parse=/^([#|+|\-|~])?([^:()]+)(?:\(([^()]+)?\))(?::([^:()]+))?$/;this.setMinWidth(100)};JSFun.extend(OperationItem,TextBox);OperationItem.prototype.encode=function(d){var c="";if(d[0]){c+=d[0]}if(d[1]){c+=d[1]}if(d[2]){c+="("+d[2]+")"}else{c+="()"}if(d[3]){c+=":"+d[3]}if(this._parse.exec(c)){return c}else{return"wrong_operation"}};OperationItem.prototype.decode=function(c){var d=this._parse.exec(c);if(d){d.shift();return d}else{return[]}};OperationItem.prototype.showDialog=function(){if(this.active){return}var u=this;this.active=true;var A=document.createElement("div");var z=document.createElement("form");var v=[];var x;for(x=0;x<4;x++){v.push(document.createElement("input"))}v[0]=document.createElement("select");var y=document.createElement("option");y.setAttribute("value","");y.appendChild(document.createTextNode("(none)"));v[0].appendChild(y);y=document.createElement("option");y.setAttribute("value","+");y.appendChild(document.createTextNode("+ (public)"));v[0].appendChild(y);y=document.createElement("option");y.setAttribute("value","-");y.appendChild(document.createTextNode("- (private)"));v[0].appendChild(y);y=document.createElement("option");y.setAttribute("value","#");y.appendChild(document.createTextNode("# (protected)"));v[0].appendChild(y);y=document.createElement("option");y.setAttribute("value","~");y.appendChild(document.createTextNode("~ (package)"));v[0].appendChild(y);var s=document.createElement("input");A.className="ud_popup";var q=this.decode(this.getValue());for(x=0;x<v.length;x++){v[x].setAttribute("type","text");v[x].setAttribute("value",q[x]||"")}if(q[0]){var t=v[0].childNodes;for(x in t){if(t[x].value==q[0]){t[x].setAttribute("selected","selected")}}}s.setAttribute("type","submit");s.setAttribute("value","ok");this.changeText=function(a){if(u.active){var c=[];var b;for(b=0;b<v.length;b++){c.push(v[b].value)}u.setText(u.encode(c));document.body.removeChild(A);u.active=false;u.notifyChange()}};this.closeDialog=function(a){if(u.active){document.body.removeChild(A);u.active=false;u.notifyChange()}};z.onsubmit=function(){return false};s.addEventListener("click",this.changeText,false);var w=["visibility","name","parameters","return"];var r;var o;for(x=0;x<v.length;x++){o=document.createElement("div");r=document.createElement("label");r.appendChild(document.createTextNode(w[x]));o.appendChild(r);o.appendChild(v[x]);z.appendChild(o)}z.appendChild(s);if(this.deletable){var p=document.createElement("input");p.setAttribute("type","submit");p.setAttribute("value","delete");this.deleteDialog=function(a){if(u.active){document.body.removeChild(A);u.active=false;u.notifyDelete();u.notifyChange()}};p.addEventListener("click",this.deleteDialog,false);z.appendChild(p)}A.appendChild(z);document.body.appendChild(A);A.style.top=(window.innerHeight-z.offsetHeight)/2+"px";A.style.left=(window.innerWidth-z.offsetWidth)/2+"px"};OperationItem.prototype.select=function(d,c){if(Math.abs(d-(this.getPixelX()+this.getSuperWidth()-20))<=5&&Math.abs(c-(this.getPixelY()+8.66))<=5){this.notifyToUp();this.notifyChange();return true}else{if(Math.abs(d-(this.getPixelX()+this.getSuperWidth()-30))<=5&&Math.abs(c-(this.getPixelY()+7.33))<=5){this.notifyToDown();this.notifyChange();return true}}return OperationItem.base.select.call(this,d,c)};OperationItem.prototype.drawShape=function(d){if(!this._visible){return}var e=this.getPixelX()+this.getSuperWidth()-35;var f=this.getPixelY()+3;d.save();d.fillStyle="#0000aa";d.beginPath();d.moveTo(e,f);d.lineTo(e+10,f);d.lineTo(e+5,f+7);d.closePath();d.fill();e=e+10;d.beginPath();d.moveTo(e+5,f);d.lineTo(e,f+7);d.lineTo(e+10,f+7);d.closePath();d.fill();d.restore()};var OperationFields=function(b){b=b||{};OperationFields.baseConstructor.call(this,b)};JSFun.extend(OperationFields,CollapsibleFields);OperationFields.prototype.newItem=function(){return new OperationItem({text:"new_operation()"})};var Rectangular=function(b){b=b||{};Rectangular.baseConstructor.call(this,b)};JSFun.extend(Rectangular,Node);var Separator=function(b){b=b||{};Separator.baseConstructor.call(this,b);this._setPosition(Component.Static);if(this._orientation){this.setWidth(b.width||1)}else{this.setHeight(b.height||1)}};JSFun.extend(Separator,Component);Separator.prototype.draw=function(b){if(!this._visible){return}b.save();b.lineWidth=(this._orientation)?(this._width-2*this._margin):(this._height-2*this._margin);b.strokeStyle=ComponentStyle.component_color;b.beginPath();if(this._orientation){b.moveTo(this.getPixelX(),this.getPixelY());b.lineTo(this.getPixelX(),this.getPixelY()+this.getHeight())}else{b.moveTo(this.getPixelX(),this.getPixelY());b.lineTo(this.getPixelX()+this.getWidth(),this.getPixelY())}b.stroke();b.restore()};var RegionLine=function(b){b=b||{};RegionLine.baseConstructor.call(this,b);this._setPosition(b.position||Component.BottomLeft);if(b.orientation){this.setHeight(b.height||100);this.setWidth(b.width||1)}else{this.setHeight(b.height||1);this.setWidth(b.width||100)}};JSFun.extend(RegionLine,Component);RegionLine.prototype.select=function(h,k){var m=this._getX();var n=this._getY();var j=-1;var o=-1;if(!this.selected&&this.isOver(h,k)){var l=this;this._selectComponent=function(a){l.getParent()._diagram.interaction(false);var c=l.getParent().getParent();if(c._orientation){for(var b=0;b<c._nodeChilds.length;b++){if(c._nodeChilds[b].getX()<l.getParent().getX()){o=b}if(c._nodeChilds[b].getX()>l._getX()){if(j==-1){j=b}}}}else{for(var b=0;b<c._nodeChilds.length;b++){if(c._nodeChilds[b].getY()<l.getParent().getY()){o=b}if(c._nodeChilds[b].getY()>l._getY()){if(j==-1){j=b}}}}};this._dragComponent=function(u){if(!(u.button==0&&l.getParent()._diagram._pressMouse)){return}var c=u.pageX-l.getParent()._diagram._div.offsetLeft;var d=u.pageY-l.getParent()._diagram._div.offsetTop;if(c<0){c=0}if(d<0){d=0}if(c>=l.getParent()._diagram._width){c=l.getParent()._diagram._width}if(d>=l.getParent()._diagram._height){d=l.getParent()._diagram._height}l.getParent()._diagram._div.style.cursor="pointer";var e=c-l.getParent()._relx;var f=d-l.getParent()._rely;var t=l.getParent().getParent();if(t._orientation){var g=l.getParent()._diagram._width;var a=l.getParent()._x+l.getParent()._minWidth;if((c>a)&&(c<g)){l._x=c}}else{var b=l.getParent()._diagram._height;var s=l.getParent()._y+l.getParent()._minHeight;if((d>s)&&(d<b)){l._y=d}}l.getParent()._diagram._drawMotion(l)};this._dropComponent=function(u){if(!(u.button==0&&l.getParent()._diagram._pressMouse)){return}var f=l._getX()-m;var t=l._getY()-n;if(l.getParent().getParent()._orientation){var d=l.getParent().getParent()._nodeChilds[j];l._x=l._x-f;if(f>0){l.getParent().setWidth(l.getParent().getWidth()+f)}else{var s=l.getParent();var b=l.getParent().getWidth()+f;l.getParent().setWidth(l.getParent().getWidth()+f);if(j!=-1){d._x=d._x+f;d.setWidth(d.getWidth()-f)}}}else{var d=l.getParent().getParent()._nodeChilds[j];l._y=l._y-t;if(t>0){l.getParent().setHeight(l.getParent().getHeight()+t)}else{var s=l.getParent();var c=l.getParent().getHeight()+t;l.getParent().setHeight(l.getParent().getHeight()+t);if(j!=-1){d._y=d._y+t;d.setHeight(d.getHeight()-t)}}}l.getParent()._diagram._div.style.cursor="default";l.getParent()._diagram._clearMotion();l.getParent()._resizing=false;l.getParent()._selected=true;l.getParent().getParent()._selected=true;var e=false;var g=true;var a=true;l.getParent().getParent().notifyChange(g,e,a);l.getParent()._diagram.draw();window.removeEventListener("mousedown",l._selectComponent,false);window.removeEventListener("mousemove",l._dragComponent,false);window.removeEventListener("mouseup",l._dropComponent,false);l.getParent()._diagram.interaction(true);l.getParent()._diagram._lastElement=l.getParent()._diagram._element;l.getParent()._diagram._element=null;j=-1;o=-1;l.getParent()._diagram._pressMouse=false};window.addEventListener("mousedown",this._selectComponent,false);window.addEventListener("mousemove",this._dragComponent,false);window.addEventListener("mouseup",this._dropComponent,false);return true}else{return false}};RegionLine.prototype.isOver=function(d,c){if(this._visible&&d>=this._x-5&&d<=this._x+this._width+5&&c>=this._y-5&&c<=this._y+this._height+5){return true}else{return false}};RegionLine.prototype.draw=function(b){if(!this._visible){return}if(this._parent.getParent()._orientation){JSGraphic.dashedLine(b,this.getPixelX(),this.getPixelY(),this.getPixelX(),this.getPixelY()+this.getHeight(),10)}else{JSGraphic.dashedLine(b,this.getPixelX(),this.getPixelY(),this.getPixelX()+this.getWidth(),this.getPixelY(),10)}};RegionLine.prototype.drawShape=function(f){if(!this._visible){return}f.save();f.strokeStyle="#aaaaaa";if(this._parent.getParent()._orientation){f.strokeRect(this.getPixelX()-2,this.getPixelY(),this.getWidth()+4,this.getHeight())}else{f.strokeRect(this.getPixelX(),this.getPixelY()-4,this.getWidth(),this.getHeight()+6)}f.restore();f.save();f.fillStyle="#ff0000";f.beginPath();if(this._parent.getParent()._orientation){f.arc(this._parent.getX()+this._parent.getWidth()-7,this._parent.getY()+7,4,0,Math.PI*2,true)}else{f.arc(this._parent.getX()+7,this._parent.getY()+this._parent.getHeight()-7,4,0,Math.PI*2,true)}f.closePath();f.fill();f.restore();var e=this._parent.getParent()._nodeChilds;for(var d=0;d<e.length;d++){if(e[d]==this._parent){break}}f.save();f.fillStyle="#ff0000";f.beginPath();if(this._parent.getParent()._orientation){f.arc(e[d+1].getX()+e[d+1].getWidth()-7,e[d+1].getY()+7,4,0,Math.PI*2,true)}else{f.arc(e[d+1].getX()+7,e[d+1].getY()+e[d+1].getHeight()-7,4,0,Math.PI*2,true)}f.closePath();f.fill();f.restore()};var SuperNode=function(b){b=b||{};SuperNode.baseConstructor.call(this,b);this._orientation=b.orientation||0;this._includeComponentByRegion=(b.includeComponentByRegion==false)?false:true;this.setContainer()};JSFun.extend(SuperNode,Node);SuperNode.prototype.addRegion=function(b){if(b instanceof Node){b.setContainer();this.addChild(b);this.notifyChange(true)}};SuperNode.prototype.deleteRegion=function(j){var k;var f;if(this._orientation){var h=j.getWidth()}else{var h=j.getHeight()}for(k=0;k<this._nodeChilds.length;k++){if(this._nodeChilds[k]==j){break}}j.deleted();var g=k;if(g==(this._nodeChilds.length)){if(this._nodeChilds[g-1]._components[2]){this._nodeChilds[g-1]._components[2].notifyDelete()}}if(this._orientation){this._minWidth=this.getWidth()-h;this.setWidth(this.getWidth()-h)}else{this._minHeight=this.getHeight()-h;this.setHeight(this.getHeight()-h)}this.notifyChange(true);this.notifyDraw()};SuperNode.prototype.notifyChange=function(j,m,k){j=j||false;m=m||false;k=k||false;this._resizing=true;if(this._nodeChilds[0]&&this._nodeChilds[0]._visible){this.updateRegions(m,k)}if(this._container){var l;if(j&&this._nodeChilds[0]&&this._nodeChilds[0]._visible){var g=this._nodeChilds;for(l=0;l<g.length;l++){if(g.length-1!=l){g[l].updateContainer(false)}else{g[l].updateContainer()}}}else{this.updateContainer()}if(this._parent){var h=this._parent.getParent();while(h){if(h instanceof SuperNode){h.notifyChange(true);h=null}else{h=h._parent}}}}else{this.updateComponents();if(this._parent){this._parent.updateContainer()}}if(this._nodeChilds[0]&&this._nodeChilds[0]._visible){this.updateRegions(m,k)}for(var l=0;l<this._nodeChilds.length;l++){this._nodeChilds[l].setDiagram(this._diagram)}this._resizing=false};SuperNode.prototype.updateContainer=function(v){if(!(v==false||v==true)){v=true}if(this._container){var r;var u=this._x;var w=this._y;var x=this._x;var y=this._y;var s;var n,o,q,t;var p=this._nodeChilds.length;for(r=0;r<p;r++){s=this._nodeChilds[r];if(s._visible){if(this._orientation){q=s._x;elemLeftY=s._y;if(r==(p-1)){n=s._x+s._minWidth}else{n=s._x+s._width}o=s._y+s._minHeight}else{q=s._x;elemLeftY=s._y;n=s._x+s._minWidth;if(r==(p-1)){o=s._y+s._minHeight}else{o=s._y+s._height}n=s._x+s._minWidth}if(n>x){x=n}if(o>y){y=o}if(q<u){u=q}if(elemLeftY<w){w=elemLeftY}}}if(u<this._x||w<this._y){this.setWidth(this._x-u+this._width);this.setHeight(this._y-w+this._height);this._x=u;this._y=w;this.setMinWidth(x-u);this.setMinHeight(y-w)}else{this.setMinWidth(x-this._x);this.setMinHeight(y-this._y)}this._prex=this._x;this._prey=this._y;this.updateComponents();if(this._parent&&v){this._parent.updateContainer()}}};SuperNode.prototype.setSelectedFigure=function(h){if(JSFun.isNumber(h)&&h>-1&&h<this._figures.length){if(this._selectedFigure==h){return false}this._selectedFigure=h;if(this._figures[h] instanceof FromImageFigure){for(var f=0;f<this._components.length;f++){if(this._components[f]._id=="name"){if(!this._beforeNameComponent){this._beforeNameComponent=this._components[f];var g=this._beforeNameComponent._text;var e=this._beforeNameComponent.selected;if(this._beforeNameComponent instanceof TextArea){this._components[f]=new TextArea({id:"name",text:g.join("\n"),selected:e,position:Component.Bottom,margin:3})}if(this._beforeNameComponent instanceof TextBox){this._components[f]=new TextBox({id:"name",text:g,selected:e,position:Component.Bottom,margin:3})}this._components[f].setParent(this)}}else{this._components[f].setVisibility(false)}}this._beforeHeight=this._height;this._beforeWidth=this._width;this._nodeChilds[this._nodeChilds.length-1]._beforeHeight=this._nodeChilds[this._nodeChilds.length-1]._height;this._nodeChilds[this._nodeChilds.length-1]._beforeWidth=this._nodeChilds[this._nodeChilds.length-1]._width;for(f=0;f<this._nodeChilds.length;f++){this._nodeChilds[f].setVisibility(false)}}else{for(var f=0;f<this._components.length;f++){if(this._components[f]._id=="name"){if(this._beforeNameComponent){if(this._beforeNameComponent instanceof TextArea){this._beforeNameComponent.setText(this._components[f]._text.join("\n"))}else{if(this._beforeNameComponent instanceof TextBox){this._beforeNameComponent.setText(this._components[f]._text)}}this._components[f]=this._beforeNameComponent;this._beforeNameComponent=null}}else{if(!(this._components[f] instanceof SpecificationItem)||this._components[f] instanceof SpecificationItem&&this._components[f].getValue()!=""){this._components[f].setVisibility(true)}}}for(f=0;f<this._nodeChilds.length;f++){this._nodeChilds[f].setVisibility(true)}this.setHeight(this._beforeHeight);this.setWidth(this._beforeWidth);this._nodeChilds[this._nodeChilds.length-1].setHeight(this._nodeChilds[this._nodeChilds.length-1]._beforeHeight);this._nodeChilds[this._nodeChilds.length-1].setWidth(this._nodeChilds[this._nodeChilds.length-1]._beforeWidth);this._beforeHeight=0;this._beforeWidth=0;this.notifyChange(true);this._diagram._sortNodesByArea()}this.updateComponents()}return true};SuperNode.prototype.updateRegions=function(v,p){v=v||false;p=p||false;var s=this._nodeChilds.length;if(this._orientation){var w=0;var q=this.getX();for(var u=0;u<s;u++){var j=this._nodeChilds[u];j.setMinHeight(this._minHeight-this._components[0].getHeight()-this._components[1].getHeight());j.setHeight(this.getHeight()-this._components[0].getHeight()-this._components[1].getHeight());if(j._components[2] instanceof RegionLine){j._components[2].setHeight(this.getHeight()-this._components[0].getHeight()-this._components[1].getHeight())}}for(u=0;u<s;u++){this._nodeChilds[u]._x=q;this._nodeChilds[u]._y=this.getY()+this._components[0].getHeight()+this._components[1].getHeight();if(u==s-1){if(v||(q+this._nodeChilds[u]._width)<(this.getWidth()+this.getX())){this._nodeChilds[u].setWidth(this.getWidth()+this.getX()-q)}else{this.setWidth(q+this._nodeChilds[u]._width-this.getX())}}q+=this._nodeChilds[u].getWidth()}for(u=0;u<s;u++){var n=this._nodeChilds[u]._x-this._nodeChilds[u]._prex;if(n>0||(n<0&&!p)){for(var t=0;t<this._nodeChilds[u]._nodeChilds.length;t++){this._nodeChilds[u]._nodeChilds[t].updatePosition(n,0,true)}}this._nodeChilds[u].resetMovement()}}else{var o=0;var r=this.getY()+this._components[0].getHeight()+this._components[1].getHeight();for(var u=0;u<s;u++){var j=this._nodeChilds[u];j.setMinWidth(this._minWidth);j.setWidth(this.getWidth());if(j._components[2] instanceof RegionLine){j._components[2].setWidth(this.getWidth())}}for(u=0;u<s;u++){this._nodeChilds[u]._x=this.getX();this._nodeChilds[u]._y=r;if(u==s-1){if(v||(r+this._nodeChilds[u]._height)<(this.getHeight()+this.getY())){this._nodeChilds[u].setHeight(this.getHeight()+this.getY()-r)}else{this.setHeight(r+this._nodeChilds[u]._height-this.getY())}}r+=this._nodeChilds[u].getHeight()}for(u=0;u<s;u++){var n=this._nodeChilds[u]._y-this._nodeChilds[u]._prey;if(n>0||(n<0&&!p)){for(var t=0;t<this._nodeChilds[u]._nodeChilds.length;t++){this._nodeChilds[u]._nodeChilds[t].updatePosition(0,n,true)}}this._nodeChilds[u].resetMovement()}}this.updateComponents();for(u=0;u<this._nodeChilds.length;u++){this._nodeChilds[u].updateComponents()}};SuperNode.prototype.select=function(s,u){if(!this._visible){return}var z;var w=-1;var v=this;this.deselectComponent();for(z=0;z<this._nodeChilds.length;z++){if(this._nodeChilds[z]._selected){w=z}this._nodeChilds[z].deselect()}if(this._diagram._activeMenu){this.removeContextualMenu()}if(this._diagram._pressMouse==true){if(this._selected){if(this._moveable&&Math.abs(s-(this._x+this._width+2.5))<=5&&Math.abs(u-(this._y+this._height+2.5))<=5){this._resizing=true;return true}}if(this._selected){var A=this._nodeChilds;for(z=0;z<A.length-1;z++){if(z==w){if(this._orientation){var q=A[z].getX()+A[z].getWidth()-7;var x=A[z].getY()+7;var r=A[z+1].getX()+A[z+1].getWidth()-7;var y=A[z+1].getY()+7}else{var q=A[z].getX()+7;var x=A[z].getY()+A[z].getHeight()-7;var r=A[z+1].getX()+7;var y=A[z+1].getY()+A[z+1].getHeight()-7}var o=new Dialog({text:"Do you want to delete the region?",cancelable:true});if(Math.abs(s-(q))<=8&&Math.abs(u-(x))<=8){this._diagram._pressMouse=false;o.show(function(){v.deleteRegion(A[z])});return true}if(Math.abs(s-(r))<=8&&Math.abs(u-(y))<=8){this._diagram._pressMouse=false;o.show(function(){v.deleteRegion(A[z+1])});return true}}}for(z=0;z<this._nodeChilds.length;z++){var p=this._nodeChilds[z];if(p.isOverComponent(s,u)){if(p.isOverRegionLine(s,u)){p.selectComponent(s,u)}else{this._relx=s-this._x;this._rely=u-this._y;this._selectedBefore=true}return true}}if(this.isOverComponent(s,u)){this._relx=s-this._x;this._rely=u-this._y;this._selectedBefore=true;return true}}if(this.isOver(s,u)){this._relx=s-this._x;this._rely=u-this._y;this._selectedBefore=this._selected;this._selected=true;return true}else{return false}}else{if(this._diagram._pressMouseRight==true){if(this.isOver(s,u)){document.oncontextmenu=function(){return false};var t=document.documentElement.scrollTop||document.body.scrollTop;s=s+this._diagram._div.offsetLeft;u=(t)?(u-t+this._diagram._div.offsetTop):(u+this._diagram._div.offsetTop);this.showContextualMenu(s,u);return true}else{return false}}}};SuperNode.prototype.drop=function(f,h){if(this._moved){if(!this._alone){this._diagram.checkForParent(this)}this.updatePosition();if(this._parent){this._parent.updateContainer();var g=this._parent.getParent();while(g){if(g instanceof SuperNode){g.notifyChange(true);g=null}else{g=g._parent}}}}else{if(this._resizing){if(this instanceof SuperNode){var j=true;var k=true;this.notifyChange(j,k)}else{this.notifyChange()}if(this._parent){this._parent.updateContainer();var g=this._parent.getParent();while(g){if(g instanceof SuperNode){g.notifyChange(true,true);g=null}else{g=g._parent}}}}else{if(this._selectedBefore){this.selectComponent(f,h)}}}this._moved=false;this._resizing=false};SuperNode.prototype.selectComponent=function(e,g){var h;for(h=0;h<this._components.length;h+=1){if(this._components[h].select(e,g)){this._activeComponent=this._components[h];return}}for(h=0;h<this._nodeChilds.length;h++){var f=this._nodeChilds[h];if(f.isOverComponent(e,g)){f.selectComponent(e,g);f._selectedBefore=true;return true}}};SuperNode.prototype.draw=function(c){if(!this._visible){return}c.save();c.fillStyle=NodeStyle.shape_color;if(this._moveable&&this._selected){c.fillRect(parseInt(this._x+this._width),parseInt(this._y+this._height),5,5)}c.restore();this.drawFigures(c);this.drawComponents(c);if(this._selected){this.drawComponentsShape(c)}for(var d=0;d<this._nodeChilds.length;d++){this._nodeChilds[d].draw(c)}if(this._selected){for(var d=0;d<this._nodeChilds.length;d++){if(this._nodeChilds[d]._components[0]){this._nodeChilds[d]._components[0].drawShape(c)}if(this._nodeChilds[d]._components[1]){this._nodeChilds[d]._components[1].drawShape(c)}}}};SuperNode.prototype.getElementXML=function(d){var f=d.createElement(this.getType());f.setAttribute("id",this.getId());f.setAttribute("x",this.getX());f.setAttribute("y",this.getY());f.setAttribute("width",this._beforeWidth||this.getWidth());f.setAttribute("height",this._beforeHeight||this.getHeight());f.setAttribute("backgroundColor",this.getBackgroundColor());f.setAttribute("orientation",this._orientation);f.setAttribute("includeComponentByRegion",this._includeComponentByRegion);var e;for(e in this._components){if(this._components[e].getId()){f.appendChild(this._components[e].getComponentXML(d))}}for(e in this._nodeChilds){f.appendChild(this._nodeChilds[e].getElementXML(d))}for(e in this._relationChilds){f.appendChild(this._relationChilds[e].getElementXML(d))}return f};SuperNode.prototype.setElementXML=function(g){this.setPosition(parseInt(g.getAttribute("x")),parseInt(g.getAttribute("y")));this.resetMovement();this.setWidth(parseInt(g.getAttribute("width")));this.setHeight(parseInt(g.getAttribute("height")));this.setBackgroundColor(g.getAttribute("backgroundColor"));this._orientation=parseInt(g.getAttribute("orientation"));this._includeComponentByRegion=g.getAttribute("includeComponentByRegion");this._includeComponentByRegion=(this._includeComponentByRegion=="true")?true:false;var e;var h=g.childNodes;for(e=0;e<h.length;e++){if(h[e].nodeName=="item"){this.setValue(h[e].getAttribute("id"),h[e].getAttribute("value"))}else{if(h[e].nodeName=="superitem"){var f;for(f in this._components){if(this._components[f].getId()==h[e].getAttribute("id")){this._components[f].setComponentXML(h[e])}}}}}};var RegionItem=function(b){b=b||{};RegionItem.baseConstructor.call(this,b)};JSFun.extend(RegionItem,TextBox);RegionItem.prototype.select=function(d,c){if(!this.selected&&this.isOver(d,c)){this.createRegion();return true}else{return false}};RegionItem.prototype.createRegion=function(){var b=this.getParent()._components.length;if(this.getParent()._orientation){this.getParent().addRegion(new Region({parent:this.getParent()}))}else{this.getParent().addRegion(new Region({parent:this.getParent()}))}};var Rhombus=function(b){b=b||{};Rhombus.baseConstructor.call(this,b)};JSFun.extend(Rhombus,Node);Rhombus.prototype.getLinkCentered=function(l,m){if(l instanceof Point){m=l.getY();l=l.getX()}var n=this.getCentralPoint();var q=n.getX();var r=n.getY();var s,k,o,p;s=this.getX();k=n.getY();o=n.getX();p=this.getY();if(l<q){if(m<r){}else{p=this.getY()+this.getHeight()}}else{if(m<r){s=this.getX()+this.getWidth()}else{s=this.getX()+this.getWidth();p=this.getY()+this.getHeight()}}return JSGraphic.lineIntersection(s,k,o,p,l,m,n.getX(),n.getY())};Rhombus.prototype.calculateSize=function(){var f;var g=0;var h=0;var e;for(e=0;e<this._components.length;e+=1){f=this._components[e];if(f.getPosition()==Component.Float){h+=f.getHeight();if(f.getWidth()>g){g=f.getWidth()}}}if(h>0){this.setMinHeight(h*2)}if(g>0){this.setMinWidth(g*2)}};Rhombus.prototype.updateComponents=function(){if(this._components.length>0){this.calculateSize();var s=this.getX();var a=this.getY();var b=this.getWidth()/2;var m=this.getHeight()/2;var p=s+b;var q=a+m;var n=this.getCentralPoint();var r=JSGraphic.lineIntersection(s,a+m,s+b,a,this.getX(),this.getY(),n.getX(),n.getY());this.insertComponents(r.getX(),r.getY(),this.getWidth()-2*(r.getX()-this.getX()),this.getHeight()-2*(r.getY()-this.getHeight()));var o;for(o in this._relations){this._relations[o].notifyChange()}}};var RoleItem=function(b){b=b||{};RoleItem.baseConstructor.call(this,b);this._parse=/^([#|+|\-|~])?([\/])?(.*)?$/};JSFun.extend(RoleItem,TextBox);RoleItem.prototype.encode=function(d){var c="";if(d[0]){c+=d[0]}if(d[1]){c+=d[1]}if(d[2]){c+=d[2]}if(this._parse.exec(c)){return c}else{return"wrong_role"}};RoleItem.prototype.decode=function(c){var d=this._parse.exec(c);if(d){d.shift();return d}else{return[]}};RoleItem.prototype.showDialog=function(){if(this.active){return}var u=this;this.active=true;var A=document.createElement("div");var z=document.createElement("form");var v=[];var x;for(x=0;x<3;x++){v.push(document.createElement("input"))}v[0]=document.createElement("select");var y=document.createElement("option");y.setAttribute("value","");y.appendChild(document.createTextNode("(none)"));v[0].appendChild(y);y=document.createElement("option");y.setAttribute("value","+");y.appendChild(document.createTextNode("+ (public)"));v[0].appendChild(y);y=document.createElement("option");y.setAttribute("value","-");y.appendChild(document.createTextNode("- (private)"));v[0].appendChild(y);y=document.createElement("option");y.setAttribute("value","#");y.appendChild(document.createTextNode("# (protected)"));v[0].appendChild(y);y=document.createElement("option");y.setAttribute("value","~");y.appendChild(document.createTextNode("~ (package)"));v[0].appendChild(y);v[1]=document.createElement("select");y=document.createElement("option");y.setAttribute("value","");y.appendChild(document.createTextNode("no"));v[1].appendChild(y);y=document.createElement("option");y.setAttribute("value","/");y.appendChild(document.createTextNode("yes"));v[1].appendChild(y);var s=document.createElement("input");A.className="ud_popup";var q=this.decode(this.getValue());for(x=0;x<v.length;x++){v[x].setAttribute("type","text");v[x].setAttribute("value",q[x]||"")}if(q[0]){var t=v[0].childNodes;for(x in t){if(t[x].value==q[0]){t[x].setAttribute("selected","selected")}}}if(q[1]){var t=v[1].childNodes;for(x in t){if(t[x].value==q[1]){t[x].setAttribute("selected","selected")}}}s.setAttribute("type","submit");s.setAttribute("value","ok");this.changeText=function(a){if(u.active){var c=[];var b;for(b=0;b<v.length;b++){c.push(v[b].value)}u.setText(u.encode(c));document.body.removeChild(A);u.active=false;u.notifyChange()}};this.closeDialog=function(a){if(u.active){document.body.removeChild(A);u.active=false;u.notifyChange()}};z.onsubmit=function(){return false};s.addEventListener("click",this.changeText,false);var w=["visibility","derived","role"];var r;var o;for(x=0;x<v.length;x++){o=document.createElement("div");r=document.createElement("label");r.appendChild(document.createTextNode(w[x]));o.appendChild(r);o.appendChild(v[x]);z.appendChild(o)}z.appendChild(s);if(this.deletable){var p=document.createElement("input");p.setAttribute("type","submit");p.setAttribute("value","delete");this.deleteDialog=function(a){if(u.active){document.body.removeChild(A);u.active=false;u.notifyDelete();u.notifyChange()}};p.addEventListener("click",this.deleteDialog,false);z.appendChild(p)}A.appendChild(z);document.body.appendChild(A);A.style.top=(window.innerHeight-z.offsetHeight)/2+"px";A.style.left=(window.innerWidth-z.offsetWidth)/2+"px"};var Space=function(b){b=b||{};Space.baseConstructor.call(this,b);if(b.height){this.setHeight(b.height||0)}};JSFun.extend(Space,Component);var SpecificationItem=function(c){c=c||{};SpecificationItem.baseConstructor.call(this,c);var d="^(entry/)?([a-zA-Z]*)?(;do/)?([a-zA-Z]*)?(;exit/)?([a-zA-Z]*)?$";this._parse=new RegExp(d);this._behaviors=new Array();this._visible=c.visible||false;this.setMinWidth(100);this.setDeletable()};JSFun.extend(SpecificationItem,TextBox);SpecificationItem.prototype.encode=function(d){var c="";if(d[0]){this._behaviors[0]=d[0];c+="entry/"}if(d[1]){c+=d[1]}if(d[2]){this._behaviors[1]=d[2];c+=";do/"}if(d[3]){c+=d[3]}if(d[4]){this._behaviors[2]=d[4];c+=";exit/"}if(d[5]){c+=d[5]}if(this._parse.exec(c)){return c}else{return"wrong_attribute"}};SpecificationItem.prototype.decode=function(c){var d=this._parse.exec(c);if(d){d.shift();return d}else{return[]}};SpecificationItem.prototype.getComponentXML=function(c){var d=c.createElement("item");if(this._id){d.setAttribute("id",this._id)}d.setAttribute("value",this.getValue());d.setAttribute("behaviors",this._behaviors);d.setAttribute("visible",this._visible);return d};SpecificationItem.prototype.setValue=function(d,e,f){if(e){this._behaviors[0]=e[0];this._behaviors[1]=e[2];this._behaviors[2]=e[4]}this._visible=(f=="true")?true:false;this.setText(d)};SpecificationItem.prototype.setText=function(g){if(JSFun.isString(g)){var e,h=0;var f=g.split(";");for(e=0;e<f.length;e++){if(f[e].length>h){h=f[e].length}}this._text=f;if(g==""){this.setWidth(40)}else{this.setWidth(h*ComponentStyle.font_width)}this.setHeight(this._text.length*ComponentStyle.line_height)}};SpecificationItem.prototype.getValue=function(){return this._text.join(";")};SpecificationItem.prototype.isOver=function(d,c){if(d>=this._x&&d<=this._x+this._width&&c>=this._y&&c<=this._y+this._height&&this._visible){return true}else{return false}};SpecificationItem.prototype.showDialog=function(){if(this.active||!this._visible){return}var w=this;this.active=true;var E=document.createElement("div");E.className="ud_popup";var D=document.createElement("form");var x=[];var A;for(A=0;A<6;A++){x.push(document.createElement("input"))}var u=document.createElement("input");u.setAttribute("type","submit");u.setAttribute("value","ok");var C;for(A=0;A<6;A+=2){x[A]=document.createElement("select");C=document.createElement("option");C.setAttribute("value","0");C.appendChild(document.createTextNode("<UNSPECIFIED>"));x[A].appendChild(C);C=document.createElement("option");C.setAttribute("value","1");C.appendChild(document.createTextNode("Activity"));x[A].appendChild(C);C=document.createElement("option");C.setAttribute("value","2");C.appendChild(document.createTextNode("FunctionBehavior"));x[A].appendChild(C);C=document.createElement("option");C.setAttribute("value","3");C.appendChild(document.createTextNode("Interaction"));x[A].appendChild(C);C=document.createElement("option");C.setAttribute("value","4");C.appendChild(document.createTextNode("OpaqueBehavior"));x[A].appendChild(C);C=document.createElement("option");C.setAttribute("value","5");C.appendChild(document.createTextNode("ProtocolStateMachine"));x[A].appendChild(C);C=document.createElement("option");C.setAttribute("value","6");C.appendChild(document.createTextNode("StateMachine"));x[A].appendChild(C)}var s=w.decode(w.getValue());for(A=0;A<x.length;A++){x[A].setAttribute("type","text");x[A].setAttribute("value",s[A]||"")}if(s[0]){var v=x[0].childNodes;for(A=0;A<v.length;A++){if(v[A].value==w._behaviors[0]){v[A].setAttribute("selected","selected")}}}if(s[2]){var v=x[2].childNodes;for(A=0;A<v.length;A++){if(v[A].value==w._behaviors[1]){v[A].setAttribute("selected","selected")}}}if(s[4]){var v=x[4].childNodes;for(A=0;A<v.length;A++){if(v[A].value==w._behaviors[2]){v[A].setAttribute("selected","selected")}}}w.changeText=function(b){if(w.active){var a=[];for(A=0;A<x.length;A++){a.push(x[A].value)}w.setText(w.encode(a));document.body.removeChild(E);w.active=false;w.notifyChange();w._parent.updateComponents();w._parent.notifyDraw()}};w.closeDialog=function(a){if(w.active){document.body.removeChild(E);w.active=false;w.notifyChange();w.notifyDraw()}};D.onsubmit=function(){return false};u.addEventListener("click",w.changeText,false);var y=["Behavior","name","Behavior","name","Behavior","name","restrictions"];var t;var j;var z=["Entry","Do Activity","Exit"];var B=-1;for(A=0;A<x.length;A++){if(A%2==0){j=document.createElement("div");j.appendChild(document.createTextNode(z[++B]));j.style.background="#ccccff";j.style.textAlign="center";j.style.fontWeight="bold";j.style.marginLeft="-10px";j.style.marginRight="-10px";j.style.font="14px";j.style.paddingTop="3px";j.style.paddingBottom="3px";D.appendChild(j)}j=document.createElement("div");t=document.createElement("label");t.appendChild(document.createTextNode(y[A]));j.appendChild(t);j.style.clear="both";j.appendChild(x[A]);D.appendChild(j)}D.appendChild(u);if(w.deletable){var r=document.createElement("input");r.setAttribute("type","submit");r.setAttribute("value","delete");w.deleteDialog=function(a){if(w.active){document.body.removeChild(E);w.active=false;w._visible=false;w.setText("");w.notifyChange();w.notifyDraw()}};r.addEventListener("click",w.deleteDialog,false);D.appendChild(r);D.appendChild(r)}E.appendChild(D);document.body.appendChild(E);u.focus();E.style.top=(window.innerHeight-D.offsetHeight)/2+"px";E.style.left=(window.innerWidth-D.offsetWidth)/2+"px"};SpecificationItem.prototype.drawShape=function(b){if(this._visible){b.save();b.strokeStyle="#aaaaaa";b.strokeRect(this.getPixelX(),this.getPixelY(),this.getWidth(),this.getHeight());b.restore()}};SpecificationItem.prototype.draw=function(l){if(!this._visible){return}l.save();l.font=ComponentStyle.font_size+" monospace";l.textBaseline="middle";l.fillStyle=ComponentStyle.text_color;var h=this._getMX();var j=this._getMY()+ComponentStyle.line_height/2;var g=this.getWidth()-2*this._getMargin();var k=0;var m;for(m=0;m<this._text.length;m++){k=h+g/2-(this._text[m].length*ComponentStyle.font_width)/2;l.fillText(this._text[m],k,j);j+=ComponentStyle.line_height}l.restore()};var TransitionItem=function(b){b=b||{};TransitionItem.baseConstructor.call(this,b);this._parse=/^([a-zA-Z]*)(?:\[([^\[\]]*)\])?(?:\/([a-zA-Z]*))?$/};JSFun.extend(TransitionItem,TextBox);TransitionItem.prototype.encode=function(d){var c="";if(d[0]){c+=d[0]}if(d[1]){c+="["+d[1]+"]"}if(d[2]){c+="/"+d[2]}if(this._parse.exec(c)){return c}else{return"wrong_operation"}};TransitionItem.prototype.decode=function(c){var d=this._parse.exec(c);if(d){d.shift();return d}else{return[]}};TransitionItem.prototype.showDialog=function(){if(this.active){return}var r=this;this.active=true;var w=document.createElement("div");w.className="ud_popup";var v=document.createElement("form");var s=[];var u;for(u=0;u<3;u++){s.push(document.createElement("input"))}var q=document.createElement("input");q.setAttribute("type","submit");q.setAttribute("value","ok");var o=this.decode(this.getValue());for(u=0;u<s.length;u++){s[u].setAttribute("type","text");s[u].setAttribute("value",o[u]||"")}this.changeText=function(b){if(r.active){var a=[];var c;for(c=0;c<s.length;c++){a.push(s[c].value)}r.setText(r.encode(a));document.body.removeChild(w);r.active=false;r.notifyChange()}};this.closeDialog=function(a){if(r.active){document.body.removeChild(w);r.active=false;r.notifyChange()}};v.onsubmit=function(){return false};q.addEventListener("click",this.changeText,false);var t=["trigger","guard","behavior"];var p;var m;for(u=0;u<s.length;u++){m=document.createElement("div");p=document.createElement("label");p.appendChild(document.createTextNode(t[u]));m.appendChild(p);m.appendChild(s[u]);v.appendChild(m)}v.appendChild(q);if(this.deletable){var n=document.createElement("input");n.setAttribute("type","submit");n.setAttribute("value","delete");this.deleteDialog=function(a){if(r.active){document.body.removeChild(w);r.active=false;r.notifyDelete();r.notifyChange()}};n.addEventListener("click",this.deleteDialog,false);v.appendChild(n)}w.appendChild(v);document.body.appendChild(w);q.focus();w.style.top=(window.innerHeight-v.offsetHeight)/2+"px";w.style.left=(window.innerWidth-v.offsetWidth)/2+"px"};